<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tigerfivegit.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="第一阶段：Go 快速入门（下篇）一、内置运算符1.1 算数运算符{width&#x3D;”4.1686034558180225in” height&#x3D;”2.2823097112860893in”}">
<meta property="og:type" content="article">
<meta property="og:title" content="Go快速入门详细讲义-下篇.md">
<meta property="og:url" content="https://tigerfivegit.github.io/2022/04/06/go/Go%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E8%AF%A6%E7%BB%86%E8%AE%B2%E4%B9%89-%E4%B8%8B%E7%AF%87/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="第一阶段：Go 快速入门（下篇）一、内置运算符1.1 算数运算符{width&#x3D;”4.1686034558180225in” height&#x3D;”2.2823097112860893in”}">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tigerfivegit.github.io/images/a1.jpg">
<meta property="og:image" content="https://tigerfivegit.github.io/images/a2.jpg">
<meta property="og:image" content="https://tigerfivegit.github.io/images/a3.jpg">
<meta property="og:image" content="https://tigerfivegit.github.io/images/a4.jpg">
<meta property="og:image" content="https://tigerfivegit.github.io/images/a5.jpg">
<meta property="og:image" content="https://tigerfivegit.github.io/images/a6.jpg">
<meta property="og:image" content="https://tigerfivegit.github.io/images/image-20210611162901626.b9d2e390.png">
<meta property="og:image" content="https://tigerfivegit.github.io/images/image-20210611162954615.c3dd5a94.png">
<meta property="og:image" content="https://tigerfivegit.github.io/images/image-20220111110347525.04783d49.png">
<meta property="article:published_time" content="2022-04-05T18:38:19.655Z">
<meta property="article:modified_time" content="2022-04-05T18:38:19.655Z">
<meta property="article:author" content="tigerfive">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tigerfivegit.github.io/images/a1.jpg">

<link rel="canonical" href="https://tigerfivegit.github.io/2022/04/06/go/Go%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E8%AF%A6%E7%BB%86%E8%AE%B2%E4%B9%89-%E4%B8%8B%E7%AF%87/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Go快速入门详细讲义-下篇.md | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tigerfivegit.github.io/2022/04/06/go/Go%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E8%AF%A6%E7%BB%86%E8%AE%B2%E4%B9%89-%E4%B8%8B%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tigerfive">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Go快速入门详细讲义-下篇.md
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-06 02:38:19" itemprop="dateCreated datePublished" datetime="2022-04-06T02:38:19+08:00">2022-04-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="第一阶段：Go-快速入门（下篇）"><a href="#第一阶段：Go-快速入门（下篇）" class="headerlink" title="第一阶段：Go 快速入门（下篇）"></a>第一阶段：Go 快速入门（下篇）</h1><h1 id="一、内置运算符"><a href="#一、内置运算符" class="headerlink" title="一、内置运算符"></a>一、内置运算符</h1><h2 id="1-1-算数运算符"><a href="#1-1-算数运算符" class="headerlink" title="1.1 算数运算符"></a>1.1 算数运算符</h2><p><img src="/images/a1.jpg">{width=”4.1686034558180225in” height=”2.2823097112860893in”}</p>
<span id="more"></span>

<p>1、<strong>算数运算符使用</strong></p>
<p>Go快速入门详细讲义-下篇.md</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;10+3=&quot;</span>, <span class="number">10</span>+<span class="number">3</span>)   <span class="comment">//10+3= 13</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;10-3=&quot;</span>, <span class="number">10</span><span class="number">-3</span>)   <span class="comment">//10-3= 7</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;10*3=&quot;</span>, <span class="number">10</span>*<span class="number">3</span>)   <span class="comment">//10*3= 30</span></span><br><span class="line">    <span class="comment">//除法注意：如果运算的数都是整数，那么除后，去掉小数部分，保留整数部分</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;10/3=&quot;</span>, <span class="number">10</span>/<span class="number">3</span>)       <span class="comment">//10/3= 3</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;10.0/3=&quot;</span>, <span class="number">10.0</span>/<span class="number">3</span>)   <span class="comment">//3.3333333333333335</span></span><br><span class="line">    <span class="comment">// 取余注意 余数=被除数-（被除数/除数）*除数</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;10%3=&quot;</span>, <span class="number">10</span>%<span class="number">3</span>)     <span class="comment">//10%3= 1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;-10%3=&quot;</span>, <span class="number">-10</span>%<span class="number">3</span>)    <span class="comment">// -10%3= -1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;10%-3=&quot;</span>, <span class="number">10</span>%<span class="number">-3</span>)    <span class="comment">// 10%-3= 1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;-10%-3=&quot;</span>, <span class="number">-10</span>%<span class="number">-3</span>)   <span class="comment">// -10%-3= -1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、<strong>i++</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i <span class="type">int</span> = <span class="number">1</span></span><br><span class="line">    i++</span><br><span class="line">    fmt.Println(<span class="string">&quot;i=&quot;</span>, i)  <span class="comment">// i= 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-关系运算符"><a href="#1-2-关系运算符" class="headerlink" title="1.2 关系运算符"></a>1.2 关系运算符</h2><p><img src="/images/a2.jpg"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> n1 <span class="type">int</span> = <span class="number">9</span></span><br><span class="line">    <span class="keyword">var</span> n2 <span class="type">int</span> = <span class="number">8</span></span><br><span class="line">    fmt.Println(n1 == n2)   <span class="comment">//false</span></span><br><span class="line">    fmt.Println(n1 != n2)   <span class="comment">//true</span></span><br><span class="line">    fmt.Println(n1 &gt; n2)    <span class="comment">//true</span></span><br><span class="line">    fmt.Println(n1 &gt;= n2)   <span class="comment">//true</span></span><br><span class="line">    fmt.Println(n1 &lt; n2)    <span class="comment">//flase</span></span><br><span class="line">    fmt.Println(n1 &lt;= n2)   <span class="comment">//flase</span></span><br><span class="line">    flag := n1 &gt; n2</span><br><span class="line">    fmt.Println(<span class="string">&quot;flag=&quot;</span>, flag)  <span class="comment">//flag= true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-3-逻辑运算符"><a href="#1-3-逻辑运算符" class="headerlink" title="1.3 逻辑运算符"></a>1.3 逻辑运算符</h2><p><img src="/images/a3.jpg">{width=”6.383173665791776in” height=”2.3970166229221346in”}</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//演示逻辑运算符的使用 &amp;&amp;</span></span><br><span class="line">    <span class="keyword">var</span> age <span class="type">int</span> = <span class="number">40</span></span><br><span class="line">    <span class="keyword">if</span> age &gt; <span class="number">30</span> &amp;&amp; age &lt; <span class="number">50</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ok1&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> age &gt; <span class="number">30</span> &amp;&amp; age &lt; <span class="number">40</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ok2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//演示逻辑运算符的使用 ||</span></span><br><span class="line">    <span class="keyword">if</span> age &gt; <span class="number">30</span> || age &lt; <span class="number">50</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ok3&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> age &gt; <span class="number">30</span> || age &lt; <span class="number">40</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ok4&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//演示逻辑运算符的使用</span></span><br><span class="line">    <span class="keyword">if</span> age &gt; <span class="number">30</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ok5&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !(age &gt; <span class="number">30</span>) &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ok6&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-4-赋值运算符"><a href="#1-4-赋值运算符" class="headerlink" title="1.4 赋值运算符"></a>1.4 赋值运算符</h2><p><img src="/images/a4.jpg">{width=”6.16953302712161in” height=”4.93458552055993in”}</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    d := <span class="number">8</span> + <span class="number">2</span>*<span class="number">8</span>    <span class="comment">//赋值运算从右向左</span></span><br><span class="line">    fmt.Println(d)   <span class="comment">//24</span></span><br><span class="line">    </span><br><span class="line">    x := <span class="number">10</span></span><br><span class="line">    x += <span class="number">5</span>        <span class="comment">//x=x+5</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;x += 5 的值:&quot;</span>, x)  <span class="comment">//24</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="二、条件循环"><a href="#二、条件循环" class="headerlink" title="二、条件循环"></a>二、条件循环</h1><h2 id="2-1-if-else-分支结构"><a href="#2-1-if-else-分支结构" class="headerlink" title="2.1 if else(分支结构)"></a>2.1 if else(分支结构)</h2><p>1、<strong>if 条件判断基本写法</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    score := <span class="number">65</span></span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">90</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> score &gt; <span class="number">75</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、<strong>if 条件判断特殊写法</strong></p>
<ul>
<li>if 条件判断还有一种特殊的写法，可以在 if 表达式之前添加一个执行语句，再根据变量值进行判断</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//这里的 score 是局部作用域</span></span><br><span class="line">    <span class="keyword">if</span> score := <span class="number">56</span>; score &gt;= <span class="number">90</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> score &gt; <span class="number">75</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">        fmt.Println(score) <span class="comment">// 只能在函数内部打印 score</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fmt.Println(score) //undefined: score</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-2-for-循环结构"><a href="#2-2-for-循环结构" class="headerlink" title="2.2 for(循环结构)"></a>2.2 for(循环结构)</h2><p><strong>2.1 for循环</strong></p>
<p>1.1、<strong>普通for循环</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 打印： 0 ~ 9 的数字</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.2 <strong>外部定义 i</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i &lt; <span class="number">10</span> &#123;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">        i++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、<strong>模拟while循环</strong></p>
<ul>
<li>Go 语言中是没有 while 语句的，我们可以通过 for 代替</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    k := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> &#123; <span class="comment">// 这里也等价 for ; ; &#123;</span></span><br><span class="line">        <span class="keyword">if</span> k &lt;= <span class="number">10</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;ok~~&quot;</span>, k)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>   <span class="comment">//break 就是跳出这个 for 循环</span></span><br><span class="line">        &#125;</span><br><span class="line">        k++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3、<strong>for range(键值循环)</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str := <span class="string">&quot;abc上海&quot;</span></span><br><span class="line">    <span class="keyword">for</span> index, val := <span class="keyword">range</span> str &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;索引=%d, 值=%c \n&quot;</span>, index, val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">索引=0, 值=a</span></span><br><span class="line"><span class="comment">索引=1, 值=b</span></span><br><span class="line"><span class="comment">索引=2, 值=c</span></span><br><span class="line"><span class="comment">索引=3, 值=上</span></span><br><span class="line"><span class="comment">索引=6, 值=海</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h2 id="2-3-switch-case"><a href="#2-3-switch-case" class="headerlink" title="2.3 switch case"></a>2.3 switch case</h2><ul>
<li>使用 switch 语句可方便地对大量的值进行条件判断</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    score := <span class="string">&quot;B&quot;</span></span><br><span class="line">    <span class="keyword">switch</span> score &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;A&quot;</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;非常棒&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;B&quot;</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;优秀&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;C&quot;</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;及格&quot;</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;不及格&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-4-break、continue"><a href="#2-4-break、continue" class="headerlink" title="2.4 break、continue"></a>2.4 break、continue</h2><blockquote>
<p>break跳出循环</p>
<p>continue跳出本次循环</p>
</blockquote>
<p>1、<strong>break跳出单循环</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    k := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> &#123; <span class="comment">// 这里也等价 for ; ; &#123;</span></span><br><span class="line">        <span class="keyword">if</span> k &lt;= <span class="number">10</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;ok~~&quot;</span>, k)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>   <span class="comment">//break 就是跳出这个 for 循环</span></span><br><span class="line">        &#125;</span><br><span class="line">        k++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、<strong>continue(继续下次循环)</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">println</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">/*1 3 5 7 9*/</span></span><br></pre></td></tr></table></figure>



<h1 id="三、函数"><a href="#三、函数" class="headerlink" title="三、函数"></a>三、函数</h1><h2 id="3-1-函数基础"><a href="#3-1-函数基础" class="headerlink" title="3.1 函数基础"></a>3.1 函数基础</h2><p>1、<strong>函数定义</strong></p>
<blockquote>
<p>函数是组织好的、可重复使用的、用于执行指定任务的代码块。</p>
<p>本文介绍了 Go 语言中函数的相关内容。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ret := intSum(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(ret) <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">intSum</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、<strong>函数返回值</strong></p>
<ul>
<li>Go 语言中通过 return 关键字向外输出返回值。</li>
<li>函数多返回值，Go 语言中函数支持多返回值，函数如果有多个返回值时必须用()将所有返回值包裹<br>起来</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    plus, sub := calc(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    fmt.Println(plus) <span class="comment">// 和为：9</span></span><br><span class="line">    fmt.Println(sub)  <span class="comment">// 差为：-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span><span class="params">(x, y <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">    sum := x + y</span><br><span class="line">    sub := x - y</span><br><span class="line">    <span class="keyword">return</span> sum, sub</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-2-函数变量作用域"><a href="#3-2-函数变量作用域" class="headerlink" title="3.2 函数变量作用域"></a>3.2 函数变量作用域</h2><p>1、<strong>全局变量</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义全局变量 num</span></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int64</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;num=%d\n&quot;</span>, num) <span class="comment">//num=10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、<strong>局部变量</strong></p>
<ul>
<li>局部变量是函数内部定义的变量， 函数内定义的变量无法在该函数外使用</li>
<li>例如下面的示例代码 main 函数中无法使用 testLocalVar 函数中定义的变量 x</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这里name是函数test的局部变量，在其他函数无法访问</span></span><br><span class="line">    <span class="comment">//fmt.Println(name)</span></span><br><span class="line">    test()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name := <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">    fmt.Println(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3、<strong>for 循环语句中定义的变量</strong></p>
<ul>
<li>我们之前讲过的 for 循环语句中定义的变量，也是只在 for 语句块中生效</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    testLocalVar3()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testLocalVar3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        fmt.Println(i) <span class="comment">//变量 i 只在当前 for 语句块中生效</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fmt.Println(i)  //此处无法使用变量 i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="四、结构体"><a href="#四、结构体" class="headerlink" title="四、结构体"></a>四、结构体</h1><h2 id="1-1-什么是结构体"><a href="#1-1-什么是结构体" class="headerlink" title="1.1 什么是结构体"></a>1.1 什么是结构体</h2><blockquote>
<p>Go语言中没有”类”的概念，也不支持”类”的继承等面向对象的概念。</p>
<p>Go语言中通过结构体的内嵌再配合接口比面向对象具有更高的扩展性和灵活性。</p>
</blockquote>
<h2 id="1-2-结构体定义"><a href="#1-2-结构体定义" class="headerlink" title="1.2 结构体定义"></a>1.2 结构体定义</h2><h3 id="1、基本实例化（法1）"><a href="#1、基本实例化（法1）" class="headerlink" title="1、基本实例化（法1）"></a>1、<strong>基本实例化（法1）</strong></h3><ul>
<li>只有当结构体实例化时，才会真正地分配内存，也就是必须实例化后才能使用结构体的字段。</li>
<li>结构体本身也是一种类型，我们可以像声明内置类型一样使用 var 关键字声明结构体类型</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    city <span class="type">string</span></span><br><span class="line">    age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p1 person</span><br><span class="line">    p1.name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">    p1.city = <span class="string">&quot;北京&quot;</span></span><br><span class="line">    p1.age = <span class="number">18</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p1=%v\n&quot;</span>, p1)  <span class="comment">// p1=&#123;张三 北京 18&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p1=%#v\n&quot;</span>, p1) <span class="comment">// p1=main.person&#123;name:&quot;张三&quot;, city:&quot;北京&quot;, age:18&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2、new实例化（法2）"><a href="#2、new实例化（法2）" class="headerlink" title="2、new实例化（法2）"></a>2、<strong>new实例化（法2）</strong></h3><ul>
<li>我们还可以通过使用 new 关键字对结构体进行实例化，得到的是结构体的地址</li>
<li>从打印的结果中我们可以看出 p2 是一个结构体指针。</li>
<li>注意：在 Golang 中支持对结构体指针直接使用.来访问结构体的成员。</li>
<li><code>p2.name = &quot;张三&quot;</code> 其实在底层是 <code>(*p2).name = &quot;张三&quot;</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    city <span class="type">string</span></span><br><span class="line">    age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p2 = <span class="built_in">new</span>(person)</span><br><span class="line">    p2.name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">    p2.age = <span class="number">20</span></span><br><span class="line">    p2.city = <span class="string">&quot;北京&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p2=%#v \n&quot;</span>, p2) <span class="comment">//p2=&amp;main.person&#123;name:&quot;张三&quot;, city:&quot;北京&quot;, age:20&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、键值对初始化（法3）"><a href="#3、键值对初始化（法3）" class="headerlink" title="3、键值对初始化（法3）"></a>3、<strong>键值对初始化（法3）</strong></h3><ul>
<li>注意：最后一个属性的,要加上</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    city <span class="type">string</span></span><br><span class="line">    age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p4 := person&#123;</span><br><span class="line">        name: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">        city: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">        age: <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// p4=main.person&#123;name:&quot;zhangsan&quot;, city:&quot;北京&quot;, age:18&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p4=%#v\n&quot;</span>, p4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-3-结构体方法和接收者"><a href="#1-3-结构体方法和接收者" class="headerlink" title="1.3 结构体方法和接收者"></a>1.3 结构体方法和接收者</h2><h3 id="1、结构体说明"><a href="#1、结构体说明" class="headerlink" title="1、结构体说明"></a>1、<strong>结构体说明</strong></h3><ul>
<li>在 go 语言中，没有类的概念但是可以给类型（结构体，自定义类型）定义方法。</li>
<li>所谓方法就是定义了接收者的函数。<ul>
<li>Go语言中的方法（Method）是一种作用于特定类型变量的函数。</li>
<li>这种特定类型变量叫做接收者（Receiver）。</li>
<li>接收者的概念就类似于其他语言中的this或者 self。</li>
</ul>
</li>
<li>方法的定义格式如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(接收者变量 接收者类型)</span></span> 方法名(参数列表) (返回参数) &#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>给结构体 Person 定义一个方法打印 Person 的信息</li>
</ul>
<h3 id="2、结构体方法和接收者"><a href="#2、结构体方法和接收者" class="headerlink" title="2、结构体方法和接收者"></a>2、<strong>结构体方法和接收者</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    age  <span class="type">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> printInfo() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;姓名:%v 年龄:%v&quot;</span>, p.name, p.age) <span class="comment">// 姓名:小王子 年龄:25</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p1 := Person&#123;</span><br><span class="line">        name: <span class="string">&quot;小王子&quot;</span>,</span><br><span class="line">        age:  <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    p1.printInfo() <span class="comment">// 姓名:小王子 年龄:25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3、值类型和指针类型接收者"><a href="#3、值类型和指针类型接收者" class="headerlink" title="3、值类型和指针类型接收者"></a>3、<strong>值类型和指针类型接收者</strong></h3><ul>
<li>实例1：给结构体 Person 定义一个方法打印 Person 的信息</li>
<li>1、值类型的接收者<ul>
<li>当方法作用于值类型接收者时，Go 语言会在代码运行时将接收者的值复制一份。</li>
<li>在值类型接收者的方法中可以获取接收者的成员值，但修改操作只是针对副本，无法修改接收<br>者变量本身。</li>
</ul>
</li>
<li>2、指针类型的接收者<ul>
<li>指针类型的接收者由一个结构体的指针组成</li>
<li>由于指针的特性，调用方法时修改接收者指针的任意成员变量，在方法结束后，修改都是有效<br>的。</li>
<li>这种方式就十分接近于其他语言中面向对象中的 this 或者 self。</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//值类型接受者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> printInfo() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;姓名:%v 年龄:%v\n&quot;</span>, p.name, p.age) <span class="comment">// 姓名:小王子 年龄:25</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//指针类型接收者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span></span> setInfo(name <span class="type">string</span>, age <span class="type">int</span>) &#123;</span><br><span class="line">    p.name = name</span><br><span class="line">    p.age = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p1 := Person&#123;</span><br><span class="line">        name: <span class="string">&quot;小王子&quot;</span>,</span><br><span class="line">        age:  <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    p1.printInfo() <span class="comment">// 姓名:小王子 年龄:25</span></span><br><span class="line">    p1.setInfo(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    p1.printInfo() <span class="comment">// 姓名:张三 年龄:20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4、一个结构体实现多个接口"><a href="#1-4、一个结构体实现多个接口" class="headerlink" title="1.4、一个结构体实现多个接口"></a>1.4、一个结构体实现多个接口</h2><ul>
<li>Golang 中一个结构体也可以实现多个接口</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	GetInfo() <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> BInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	SetInfo(<span class="type">string</span>, <span class="type">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p People)</span></span> GetInfo() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;姓名:%v 年龄:%d&quot;</span>, p.Name, p.Age)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *People)</span></span> SetInfo(name <span class="type">string</span>, age <span class="type">int</span>) &#123;</span><br><span class="line">	p.Name = name</span><br><span class="line">	p.Age = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> people = &amp;People&#123;</span><br><span class="line">		Name: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">		Age: <span class="number">20</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// people 实现了 AInterface 和 BInterface</span></span><br><span class="line">	<span class="keyword">var</span> p1 AInterface = people</span><br><span class="line">	<span class="keyword">var</span> p2 BInterface = people</span><br><span class="line">	fmt.Println(p1.GetInfo())</span><br><span class="line">	p2.SetInfo(<span class="string">&quot;李四&quot;</span>, <span class="number">30</span>)         <span class="comment">// 姓名:张三 年龄:20</span></span><br><span class="line">	fmt.Println(p1.GetInfo())      <span class="comment">// 姓名:李四 年龄:30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-5、接口嵌套-继承"><a href="#1-5、接口嵌套-继承" class="headerlink" title="1.5、接口嵌套(继承)"></a>1.5、接口嵌套(<code>继承</code>)</h2><ul>
<li>接口与接口间可以通过嵌套创造出新的接口。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">type</span> SayInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	say()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> MoveInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	move()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接口嵌套</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">	SayInterface</span><br><span class="line">	MoveInterface</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> say() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;喵喵喵&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> move() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;猫会动&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> x Animal</span><br><span class="line">	x = Cat&#123;name: <span class="string">&quot;花花&quot;</span>&#125;</span><br><span class="line">	x.move()    <span class="comment">// 猫会动</span></span><br><span class="line">	x.say()     <span class="comment">// 喵喵喵</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="五、面向对象"><a href="#五、面向对象" class="headerlink" title="五、面向对象"></a>五、面向对象</h1><h2 id="5-1-Golang接口的定义"><a href="#5-1-Golang接口的定义" class="headerlink" title="5.1 Golang接口的定义"></a>5.1 Golang接口的定义</h2><p>1、<strong>Golang 中的接口</strong></p>
<ul>
<li>在Go语言中接口（interface）是一种类型，一种抽象的类型。</li>
<li>接口（interface）定义了一个对象的行为规范，<code>只定义规范不实现</code>，由具体的对象来实现规范的细<br>节。</li>
<li>实现接口的条件<ul>
<li>一个对象只要全部实现了接口中的方法，那么就实现了这个接口。</li>
<li>换句话说，接口就是一个需要实现的方法列表。</li>
</ul>
</li>
</ul>
<p>2、<strong>为什么要使用接口</strong></p>
<ul>
<li>上面的代码中定义了猫和狗，然后它们都会叫，你会发现main函数中明显有重复的代码</li>
<li>如果我们后续再加上猪、青蛙等动物的话，我们的代码还会一直重复下去</li>
<li>那我们能不能把它们当成“能叫的动物”来处理呢？</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> Say() <span class="type">string</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> c.Name + <span class="string">&quot;：喵喵喵&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span></span> Say() <span class="type">string</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> d.Name + <span class="string">&quot;: 汪汪汪&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := Cat&#123;Name: <span class="string">&quot;小白猫&quot;</span>&#125; <span class="comment">// 小白猫：喵喵喵</span></span><br><span class="line">    fmt.Println(c.Say())</span><br><span class="line">    d := Dog&#123;<span class="string">&quot;阿黄&quot;</span>&#125;</span><br><span class="line">    fmt.Println(d.Say()) <span class="comment">// 阿黄: 汪汪汪</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">小白猫：喵喵喵</span></span><br><span class="line"><span class="comment">阿黄: 汪汪汪</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<p>3、<strong>定义一个Usber接口</strong></p>
<ul>
<li>定义一个 Usber 接口让 Phone 和 Camera 结构体实现这个接口</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.接口是一个规范</span></span><br><span class="line"><span class="keyword">type</span> Usber <span class="keyword">interface</span> &#123;</span><br><span class="line">    start()</span><br><span class="line">    stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.如果接口里面有方法的话，必要要通过结构体或者通过自定义类型实现这个接口</span></span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.手机要实现usb接口的话必须得实现usb接口中的所有方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span></span> start() &#123;</span><br><span class="line">    fmt.Println(p.Name, <span class="string">&quot;启动&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span></span> stop() &#123;</span><br><span class="line">    fmt.Println(p.Name, <span class="string">&quot;关机&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := Phone&#123;</span><br><span class="line">        Name: <span class="string">&quot;华为手机&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> p1 Usber   <span class="comment">// golang中接口就是一个数据类型</span></span><br><span class="line">    p1 = p       <span class="comment">// 表示手机实现Usb接口</span></span><br><span class="line">    p1.start()</span><br><span class="line">    p1.stop()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">华为手机 启动</span></span><br><span class="line"><span class="comment">华为手机 关机</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>4、<strong>go中类</strong></p>
<ul>
<li><p>Go语言中没有”类”的概念，也不支持”类”的继承等面向对象的概念。</p>
</li>
<li><p>Go语言中通过结构体的内嵌再配合接口比面向对象具有更高的扩展性和灵活性。</p>
</li>
</ul>
<h2 id="5-2-空接口"><a href="#5-2-空接口" class="headerlink" title="5.2 空接口"></a>5.2 空接口</h2><p>1、<strong>空接口说明</strong></p>
<ul>
<li><p>golang中空接口也可以直接当做类型来使用，可以表示任意类型</p>
</li>
<li><p>Golang 中的接口可以不定义任何方法，没有定义任何方法的接口就是空接口。</p>
</li>
<li><p>空接口表示没有任何约束，因此任何类型变量都可以实现空接口。</p>
</li>
<li><p>空接口在实际项目中用的是非常多的，用空接口可以表示任意数据类型。</p>
</li>
</ul>
<p>2、<strong>空接口作为函数的参数</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//空接口作为函数的参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(a <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;值:%v 类型:%T\n&quot;</span>, a, a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    show(<span class="number">20</span>)                      <span class="comment">// 值:20 类型:int</span></span><br><span class="line">    show(<span class="string">&quot;你好golang&quot;</span>)            <span class="comment">// 值:你好golang 类型:string</span></span><br><span class="line">    slice := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">4</span>&#125;</span><br><span class="line">    show(slice)                     <span class="comment">// 值:[1 2 34 4] 类型:[]int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、<strong>切片实现空接口</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> slice = []<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>, <span class="literal">true</span>, <span class="number">32.2</span>&#125;</span><br><span class="line">    fmt.Println(slice)  <span class="comment">// [张三 20 true 32.2]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、<strong>map 的值实现空接口</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 空接口作为 map 值</span></span><br><span class="line">    <span class="keyword">var</span> studentInfo = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">    studentInfo[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;张三&quot;</span></span><br><span class="line">    studentInfo[<span class="string">&quot;age&quot;</span>] = <span class="number">18</span></span><br><span class="line">    studentInfo[<span class="string">&quot;married&quot;</span>] = <span class="literal">false</span></span><br><span class="line">    fmt.Println(studentInfo)</span><br><span class="line">    <span class="comment">// [age:18 married:false name:张三]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-3-类型断言"><a href="#5-3-类型断言" class="headerlink" title="5.3 类型断言"></a>5.3 类型断言</h2><ul>
<li>一个接口的值（简称接口值）是由一个具体类型和具体类型的值两部分组成的。</li>
<li>这两部分分别称为接口的动态类型和动态值。</li>
<li>如果我们想要判断空接口中值的类型，那么这个时候就可以使用类型断言</li>
<li>其语法格式：x.(T)<ul>
<li>x : 表示类型为 interface{}的变量</li>
<li>T : 表示断言 x 可能是的类型</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    x = <span class="string">&quot;Hello golnag&quot;</span></span><br><span class="line">    v, ok := x.(<span class="type">string</span>)</span><br><span class="line">    <span class="keyword">if</span> ok &#123;</span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;非字符串类型&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-4-值接收者和指针接收者"><a href="#5-4-值接收者和指针接收者" class="headerlink" title="5.4 值接收者和指针接收者"></a>5.4 值接收者和指针接收者</h2><p>1、<strong>值接收者</strong></p>
<ul>
<li>当方法作用于值类型接收者时，Go语言会在代码运行时将接收者的值复制一份。</li>
<li>在值类型接收者的方法中可以获取接收者的成员值，但修改操作只是针对副本，无法修改接收者变<br>量本身。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">type</span> Usb <span class="keyword">interface</span> &#123;</span><br><span class="line">    Start()</span><br><span class="line">    Stop()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span></span> Start() &#123;</span><br><span class="line">    fmt.Println(p.Name, <span class="string">&quot;开始工作&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span></span> Stop() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;phone 停止&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    phone1 := Phone&#123;       <span class="comment">// 一：实例化值类型</span></span><br><span class="line">        Name: <span class="string">&quot;小米手机&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> p1 Usb = phone1      <span class="comment">//phone1 实现了 Usb 接口 phone1 是 Phone 类型</span></span><br><span class="line">    p1.Start()</span><br><span class="line"></span><br><span class="line">    phone2 := &amp;Phone&#123;        <span class="comment">// 二：实例化指针类型</span></span><br><span class="line">        Name: <span class="string">&quot;苹果手机&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> p2 Usb = phone2      <span class="comment">//phone2 实现了 Usb 接口 phone2 是 *Phone 类型</span></span><br><span class="line">    p2.Start()            <span class="comment">//苹果手机 开始工作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、<strong>指针接收者</strong></p>
<ul>
<li>指针类型的接收者由一个结构体的指针组成</li>
<li>由于指针的特性，调用方法时修改接收者指针的任意成员变量，在方法结束后，修改都是有效的。</li>
<li>这种方式就十分接近于其他语言中面向对象中的this 或者self 。</li>
<li>例如我们为Person 添加一个SetAge 方法，来修改实例变量的年龄。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">type</span> Usb <span class="keyword">interface</span> &#123;</span><br><span class="line">    Start()</span><br><span class="line">    Stop()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Phone)</span></span> Start() &#123;</span><br><span class="line">    fmt.Println(p.Name, <span class="string">&quot;开始工作&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Phone)</span></span> Stop() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;phone 停止&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">/*错误写法</span></span><br><span class="line"><span class="comment">    phone1 := Phone&#123;</span></span><br><span class="line"><span class="comment">        Name: &quot;小米手机&quot;,</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    var p1 Usb = phone1</span></span><br><span class="line"><span class="comment">    p1.Start()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//正确写法</span></span><br><span class="line">    phone2 := &amp;Phone&#123;     <span class="comment">// 指针类型接收者只能传入指针类型，不能传入值类型</span></span><br><span class="line">        Name: <span class="string">&quot;苹果手机&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> p2 Usb = phone2 <span class="comment">//phone2 实现了 Usb 接口 phone2 是 *Phone 类型</span></span><br><span class="line">    p2.Start()</span><br><span class="line">    <span class="comment">//苹果手机 开始工作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、<strong>值类型接收者使用时机</strong></p>
<ul>
<li>1、需要修改接收者中的值</li>
<li>2、接收者是拷贝代价比较大的大对象</li>
<li>3、保证一致性，如果有某个方法使用了指针接收者，那么其他的方法也应该使用指针接收者。</li>
</ul>
<h1 id="六、并发编程"><a href="#六、并发编程" class="headerlink" title="六、并发编程"></a>六、并发编程</h1><h2 id="6-1-并发介绍"><a href="#6-1-并发介绍" class="headerlink" title="6.1 并发介绍"></a>6.1 并发介绍</h2><p>1、<strong>并发和并行</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A. 多线程程序在一个核的cpu上运行，就是并发。</span><br><span class="line">B. 多线程程序在多个核的cpu上运行，就是并行。</span><br></pre></td></tr></table></figure>

<ul>
<li>并发：本质还是串行</li>
</ul>
<p><img src="/images/a5.jpg">{width=”6.16953302712161in” height=”2.9602318460192474in”}</p>
<ul>
<li>并行：任务分布在不同CPU上，同一时间点同时执行</li>
</ul>
<p><img src="/images/a6.jpg">{width=”3.126453412073491in” height=”1.6674409448818897in”}</p>
<ol start="2">
<li> <strong>协程和线程</strong></li>
</ol>
<ul>
<li><p>协程：独立的栈空间，共享堆空间，调度由用户自己控制，本质上有点类似于用户级线程，这些用户级线程的调度也是自己实现的。</p>
</li>
<li><p>线程：一个线程上可以跑多个协程，协程是轻量级的线程。</p>
</li>
</ul>
<h2 id="6-2-goroutine"><a href="#6-2-goroutine" class="headerlink" title="6.2 goroutine"></a>6.2 goroutine</h2><p>1、<strong>多线程编程缺点</strong></p>
<ul>
<li><p>在java/c++中我们要实现并发编程的时候，我们通常需要自己维护一个线程池</p>
</li>
<li><p>并且需要自己去包装一个又一个的任务，同时需要自己去调度线程执行任务并维护上下文切换</p>
</li>
</ul>
<p>2、<strong>gouroutine</strong></p>
<ul>
<li><p>Go语言中的goroutine就是这样一种机制，goroutine的概念类似于线程，但 goroutine是由Go的运行时（runtime）调度和管理的。</p>
</li>
<li><p>Go程序会智能地将 goroutine 中的任务合理地分配给每个CPU。</p>
</li>
<li><p>Go语言之所以被称为现代化的编程语言，就是因为它在语言层面已经内置了调度和上下文切换的机制。</p>
</li>
<li><p>在Go语言编程中你不需要去自己写进程、线程、协程，你的技能包里只有一个技能–goroutine 当你需要让某个任务并发执行的时候，你只需要把这个任务包装成一个函数开启一个goroutine去执行这个函数就可以了，就是这么简单粗暴。</p>
</li>
</ul>
<h2 id="6-3-协程基本使用"><a href="#6-3-协程基本使用" class="headerlink" title="6.3 协程基本使用"></a>6.3 协程基本使用</h2><p>1、<strong>启动一个协程</strong></p>
<ul>
<li>主线程中每个100毫秒打印一次，总共打印2次</li>
<li>另外开启一个协程，打印10次</li>
<li>情况一：打印是交替，证明是并行的</li>
<li>情况二：开启的协程打印两次，就退出了（因为主线程退出了）</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;test() 你好golang&quot;</span>)</span><br><span class="line">        time.Sleep(time.Millisecond * <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> test() <span class="comment">//表示开启一个协程</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;main() 你好golang&quot;</span>)</span><br><span class="line">        time.Sleep(time.Millisecond * <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">main() 你好golang</span></span><br><span class="line"><span class="comment">test() 你好golang</span></span><br><span class="line"><span class="comment">main() 你好golang</span></span><br><span class="line"><span class="comment">test() 你好golang</span></span><br><span class="line"><span class="comment">test() 你好golang</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<p>2、<strong>WaitGroup</strong></p>
<ul>
<li>主线程退出后所有的协程无论有没有执行完毕都会退出</li>
<li>所以我们在主进程中可以通过WaitGroup等待协程执行完毕<ul>
<li>sync.WaitGroup内部维护着一个计数器，计数器的值可以增加和减少。</li>
<li>例如当我们启动了N 个并发任务时，就将计数器值增加N。</li>
<li>每个任务完成时通过调用Done()方法将计数器减1。</li>
<li>通过调用Wait()来等待并发任务执行完，当计数器值为0时，表示所有并发任务已经完成。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var wg sync.WaitGroup       // 第一步：定义一个计数器</span><br><span class="line">wg.Add(1)               // 第二步：开启一个协程计数器+1</span><br><span class="line">wg.Done()               // 第三步：协程执行完毕，计数器-1</span><br><span class="line">wg.Wait()               // 第四步：计数器为0时推出</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup           <span class="comment">// 第一步：定义一个计数器</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;test1() 你好golang-&quot;</span>, i)</span><br><span class="line">        time.Sleep(time.Millisecond * <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Done() <span class="comment">//协程计数器-1    // 第三步：协程执行完毕，计数器-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;test2() 你好golang-&quot;</span>, i)</span><br><span class="line">        time.Sleep(time.Millisecond * <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Done() <span class="comment">//协程计数器-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)  <span class="comment">//协程计数器+1       第二步：开启一个协程计数器+1</span></span><br><span class="line">    <span class="keyword">go</span> test1() <span class="comment">//表示开启一个协程</span></span><br><span class="line">    wg.Add(<span class="number">1</span>)  <span class="comment">//协程计数器+1</span></span><br><span class="line">    <span class="keyword">go</span> test2() <span class="comment">//表示开启一个协程</span></span><br><span class="line"></span><br><span class="line">    wg.Wait() <span class="comment">//等待协程执行完毕...   第四步：计数器为0时推出</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;主线程退出...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">test2() 你好golang- 0</span></span><br><span class="line"><span class="comment">test1() 你好golang- 0</span></span><br><span class="line"><span class="comment">.....</span></span><br><span class="line"><span class="comment">test1() 你好golang- 8</span></span><br><span class="line"><span class="comment">test1() 你好golang- 9</span></span><br><span class="line"><span class="comment">主线程退出...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<p>3、<strong>开启多个协程</strong></p>
<ul>
<li>在 Go 语言中实现并发就是这样简单，我们还可以启动多个 goroutine。</li>
<li>这里使用了 sync.WaitGroup 来实现等待 goroutine 执行完毕</li>
<li>多次执行上面的代码，会发现每次打印的数字的顺序都不一致。</li>
<li>这是因为 10 个 goroutine是并发执行的，而 goroutine 的调度是随机的。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done() <span class="comment">// goroutine结束就登记-1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello Goroutine!&quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>) <span class="comment">// 启动一个goroutine就登记+1</span></span><br><span class="line">        <span class="keyword">go</span> hello(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait() <span class="comment">// 等待所有登记的goroutine都结束</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Hello Goroutine! 0</span></span><br><span class="line"><span class="comment">Hello Goroutine! 8</span></span><br><span class="line"><span class="comment">Hello Goroutine! 2</span></span><br><span class="line"><span class="comment">Hello Goroutine! 7</span></span><br><span class="line"><span class="comment">Hello Goroutine! 6</span></span><br><span class="line"><span class="comment">Hello Goroutine! 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Hello Goroutine! 5</span></span><br><span class="line"><span class="comment">Hello Goroutine! 9</span></span><br><span class="line"><span class="comment">Hello Goroutine! 3</span></span><br><span class="line"><span class="comment">Hello Goroutine! 4</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h2 id="6-4-Channel"><a href="#6-4-Channel" class="headerlink" title="6.4.Channel"></a>6.4.Channel</h2><h3 id="1-Channel-管道"><a href="#1-Channel-管道" class="headerlink" title="1.Channel 管道"></a>1.Channel 管道</h3><h4 id="1-1-Channel说明"><a href="#1-1-Channel说明" class="headerlink" title="1.1 Channel说明"></a>1.1 Channel说明</h4><ul>
<li>共享内存交互数据弊端<ul>
<li>单纯地将函数并发执行是没有意义的。函数与函数间需要交换数据才能体现并发执行函数的意义。</li>
<li>虽然可以使用共享内存进行数据交换，但是共享内存在不同的goroutine中容易发生竞态问题。</li>
<li>为了保证数据交换的正确性，必须使用互斥量对内存进行加锁，这种做法势必造成性能问题。</li>
</ul>
</li>
<li>channel好处<ul>
<li>Go 语言中的通道（channel）是一种特殊的类型。</li>
<li>通道像一个传送带或者队列，总是遵循先入先出（First In First Out）的规则，保证收发数据的顺序。</li>
<li>每一个通道都是一个具体类型的导管，也就是声明channel的时候需要为其指定元素类型。</li>
<li>如果说goroutine是Go程序并发的执行体，channel就是它们之间的连接。</li>
<li>channel是可以让一个goroutine发送特定值到另一个goroutine的通信机制。</li>
</ul>
</li>
</ul>
<h4 id="1-2-channel类型"><a href="#1-2-channel类型" class="headerlink" title="1.2 channel类型"></a>1.2 channel类型</h4><ul>
<li>channel 是一种类型，一种引用类型</li>
<li>声明管道类型的格式如下:</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量 <span class="keyword">chan</span> 元素类型</span><br><span class="line"><span class="keyword">var</span> ch1 <span class="keyword">chan</span> <span class="type">int</span>     <span class="comment">// 声明一个传递整型的管道</span></span><br><span class="line"><span class="keyword">var</span> ch2 <span class="keyword">chan</span> <span class="type">bool</span>    <span class="comment">// 声明一个传递布尔型的管道</span></span><br><span class="line"><span class="keyword">var</span> ch3 <span class="keyword">chan</span> []<span class="type">int</span>    <span class="comment">// 声明一个传递 int 切片的管道</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-创建channel"><a href="#1-3-创建channel" class="headerlink" title="1.3 创建channel"></a>1.3 创建channel</h4><ul>
<li>声明的管道后需要使用 make 函数初始化之后才能使用。</li>
<li>创建 <strong>channel</strong> 的格式如下：<code>make(chan 元素类型, 容量)</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个能存储 10 个 int 类型数据的管道</span></span><br><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// 创建一个能存储 4 个 bool 类型数据的管道</span></span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">// 创建一个能存储 3 个[]int 切片类型数据的管道</span></span><br><span class="line">ch3 := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="type">int</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-channel操作"><a href="#2-channel操作" class="headerlink" title="2.channel操作"></a>2.channel操作</h3><ul>
<li>管道有发送（send）、接收(receive）和关闭（close）三种操作。</li>
<li>发送和接收都使用&lt;-符号。</li>
<li>现在我们先使用以下语句定义一个管道：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-1-发送（将数据放在管道内）"><a href="#2-1-发送（将数据放在管道内）" class="headerlink" title="2.1 发送（将数据放在管道内）"></a>2.1 发送（将数据放在管道内）</h4><ul>
<li>将一个值发送到管道中。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- <span class="number">10</span>  <span class="comment">// 把 10 发送到 ch 中</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-接收（从管道内取值）"><a href="#2-2-接收（从管道内取值）" class="headerlink" title="2.2 接收（从管道内取值）"></a>2.2 接收（从管道内取值）</h4><ul>
<li>从一个管道中接收值。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x := &lt;- ch     <span class="comment">// 从 ch 中接收值并赋值给变量 x</span></span><br><span class="line">&lt;-ch        <span class="comment">// 从 ch 中接收值，忽略结果</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-关闭管道"><a href="#2-3-关闭管道" class="headerlink" title="2.3 关闭管道"></a>2.3 关闭管道</h4><ul>
<li>我们通过调用内置的 close 函数来关闭管道: <code>close(ch)</code></li>
<li>关于关闭管道需要注意的事情是，只有在通知接收方 goroutine 所有的数据都发送完毕的时候才需要关闭管道。</li>
<li>管道是可以被垃圾回收机制回收的，它和关闭文件是不一样的，在结束操作之后关闭文件是必须要做的，但关闭管道不是必须的。</li>
<li>关闭后的管道有以下特点：<ul>
<li>对一个关闭的管道再发送值就会导致 panic。</li>
<li>对一个关闭的管道进行接收会一直获取值直到管道为空</li>
<li>对一个关闭的并且没有值的管道执行接收操作会得到对应类型的零值。</li>
<li>关闭一个已经关闭的管道会导致 panic。</li>
</ul>
</li>
</ul>
<h4 id="2-4-管道阻塞"><a href="#2-4-管道阻塞" class="headerlink" title="2.4 管道阻塞"></a>2.4 管道阻塞</h4><h5 id="2-4-1-无缓冲的管道"><a href="#2-4-1-无缓冲的管道" class="headerlink" title="2.4.1 无缓冲的管道"></a>2.4.1 无缓冲的管道</h5><ul>
<li>如果创建管道的时候没有指定容量，那么我们可以叫这个管道为无缓冲的管道</li>
<li>无缓冲的管道又称为阻塞的管道。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	ch &lt;- <span class="number">10</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;发送成功&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">-- 面这段代码能够通过编译，但是执行的时候会出现以下错误</span></span><br><span class="line"><span class="comment">fatal error: all goroutines are asleep - deadlock!</span></span><br><span class="line"><span class="comment">goroutine 1 [chan send]:</span></span><br><span class="line"><span class="comment">main.main()</span></span><br><span class="line"><span class="comment">	E:/_000/Go/Code/demo1.go:6 +0x5f</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20210611162901626.b9d2e390.png" alt="img"></p>
<h5 id="2-4-2-有缓冲的管道"><a href="#2-4-2-有缓冲的管道" class="headerlink" title="2.4.2 有缓冲的管道"></a>2.4.2 有缓冲的管道</h5><ul>
<li>解决上面问题的方法还有一种就是使用有缓冲区的管道。</li>
<li>我们可以在使用 make 函数初始化管道的时候为其指定管道的容量</li>
<li>只要管道的容量大于零，那么该管道就是有缓冲的管道，管道的容量表示管道中能存放元素的数量。</li>
<li>就像你小区的快递柜只有那么个多格子，格子满了就装不下了，就阻塞了，等到别人取走一个快递员就能往里面放一个。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">5</span>)</span><br><span class="line">	ch &lt;- <span class="number">10</span></span><br><span class="line">	ch &lt;- <span class="number">12</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;发送成功&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20210611162954615.c3dd5a94.png" alt="img"></p>
<h3 id="3-从channel取值"><a href="#3-从channel取值" class="headerlink" title="3.从channel取值"></a>3.从channel取值</h3><h4 id="3-1-优雅的从channel取值"><a href="#3-1-优雅的从channel取值" class="headerlink" title="3.1 优雅的从channel取值"></a>3.1 优雅的从channel取值</h4><ul>
<li>当通过通道发送有限的数据时，我们可以通过close函数关闭通道来告知从该通道接收值的goroutine停止等待。</li>
<li>当通道被关闭时，往该通道发送值会引发panic，从该通道里接收的值一直都是类型零值。</li>
<li>那如何判断一个通道是否被关闭了呢？</li>
<li>for range的方式判断通道关闭</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(ch1 <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">		ch1 &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(ch1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(ch1 <span class="keyword">chan</span> <span class="type">int</span>, ch2 <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		i, ok := &lt;-ch1 <span class="comment">// 通道关闭后再取值ok=false</span></span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		ch2 &lt;- i * i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(ch2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// channel 练习</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	<span class="comment">// 开启goroutine将0~100的数发送到ch1中</span></span><br><span class="line">	<span class="keyword">go</span> f1(ch1)</span><br><span class="line">	<span class="comment">// 开启goroutine从ch1中接收值，并将该值的平方发送到ch2中</span></span><br><span class="line">	<span class="keyword">go</span> f2(ch1, ch2)</span><br><span class="line">	<span class="comment">// 在主goroutine中从ch2中接收值打印</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> ch2 &#123; <span class="comment">// 通道关闭后会退出for range循环</span></span><br><span class="line">		fmt.Println(i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-2-Goroutine结合Channel管道"><a href="#3-2-Goroutine结合Channel管道" class="headerlink" title="3.2 Goroutine结合Channel管道"></a>3.2 Goroutine结合Channel管道</h4><ul>
<li>需求 <strong>1</strong>：定义两个方法，一个方法给管道里面写数据，一个给管道里面读取数据，要求同步进行。</li>
<li>1、开启一个 fn1 的的协程给向管道 inChan 中写入 100 条数据</li>
<li>2、开启一个 fn2 的协程读取 inChan 中写入的数据</li>
<li>3、注意：fn1 和 fn2 同时操作一个管道</li>
<li>4、主线程必须等待操作完成后才可以退出</li>
<li><code>注：for range的方式判断通道关闭，推出程序</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">10</span>)</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> write(intChan)</span><br><span class="line">	<span class="keyword">go</span> read(intChan)</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;读取完毕...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(intChan <span class="keyword">chan</span> <span class="type">int</span>)</span></span>  &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(intChan)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(intChan <span class="keyword">chan</span> <span class="type">int</span>)</span></span>  &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> intChan &#123;</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-单向管道"><a href="#4-单向管道" class="headerlink" title="4.单向管道"></a>4.单向管道</h3><ul>
<li>有的时候我们会将管道作为参数在多个任务函数间传递</li>
<li>很多时候我们在不同的任务函数中使用管道都会对其进行限制</li>
<li>比如限制管道在函数中只能发送或只能接收</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//1. 在默认情况下下，管道是双向</span></span><br><span class="line">	<span class="comment">//var chan1 chan int //可读可写</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2 声明为只写</span></span><br><span class="line">	<span class="keyword">var</span> chan2 <span class="keyword">chan</span>&lt;- <span class="type">int</span></span><br><span class="line">	chan2 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">	chan2&lt;- <span class="number">20</span></span><br><span class="line">	<span class="comment">//num := &lt;-chan2 //error</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;chan2=&quot;</span>, chan2)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//3. 声明为只读</span></span><br><span class="line">	<span class="keyword">var</span> chan3 &lt;-<span class="keyword">chan</span> <span class="type">int</span></span><br><span class="line">	num2 := &lt;-chan3</span><br><span class="line">	<span class="comment">//chan3&lt;- 30 //err</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;num2&quot;</span>, num2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="5-Goroutine池"><a href="#5-Goroutine池" class="headerlink" title="5.Goroutine池"></a>5.Goroutine池</h3><ul>
<li>本质上是生产者消费者模型</li>
<li>在工作中我们通常会使用可以指定启动的goroutine数量–<code>worker pool</code>模式，控制<code>goroutine</code>的数量，防止<code>goroutine</code>泄漏和暴涨。</li>
<li>一个简易的<code>work pool</code>示例代码如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="type">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="type">int</span>, results <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> j := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;worker:%d start job:%d\n&quot;</span>, id, j)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		fmt.Printf(<span class="string">&quot;worker:%d end job:%d\n&quot;</span>, id, j)</span><br><span class="line">		results &lt;- j * <span class="number">2</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">	results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">	<span class="comment">// 开启3个goroutine</span></span><br><span class="line">	<span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">		<span class="keyword">go</span> worker(w, jobs, results)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 5个任务</span></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">5</span>; j++ &#123;</span><br><span class="line">		jobs &lt;- j</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(jobs)</span><br><span class="line">	<span class="comment">// 输出结果</span></span><br><span class="line">	<span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= <span class="number">5</span>; a++ &#123;</span><br><span class="line">		&lt;-results</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-5-select"><a href="#6-5-select" class="headerlink" title="6.5.select"></a>6.5.select</h2><p>select 多路复用</p>
<h3 id="6-1-select说明"><a href="#6-1-select说明" class="headerlink" title="6.1 select说明"></a>6.1 select说明</h3><ul>
<li>传统的方法在遍历管道时，如果不关闭会阻塞而导致 deadlock，在实际开发中，可能我们不好确定什么关闭该管道。</li>
<li>这种方式虽然可以实现从多个管道接收值的需求，但是运行性能会差很多。</li>
<li>为了应对这种场景，Go 内置了 select 关键字，可以同时响应多个管道的操作。</li>
<li>select 的使用类似于 switch 语句，它有一系列 case 分支和一个默认的分支。</li>
<li>每个 case 会对应一个管道的通信（接收或发送）过程。</li>
<li>select 会一直等待，直到某个 case 的通信操作完成时，就会执行 case 分支对应的语句。</li>
<li>具体格式如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-chan1:</span><br><span class="line">   <span class="comment">// 如果chan1成功读到数据，则进行该case处理语句</span></span><br><span class="line"><span class="keyword">case</span> chan2 &lt;- <span class="number">1</span>:</span><br><span class="line">   <span class="comment">// 如果成功向chan2写入数据，则进行该case处理语句</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">   <span class="comment">// 如果上面都没有成功，则进入default处理流程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-select-的使用"><a href="#6-2-select-的使用" class="headerlink" title="6.2 select 的使用"></a>6.2 select 的使用</h3><ul>
<li>使用 select 语句能提高代码的可读性。</li>
<li>可处理一个或多个 channel 的发送/接收操作。</li>
<li>如果多个 case 同时满足，select 会随机选择一个。</li>
<li>对于没有 case 的 select{}会一直等待，可用于阻塞 main 函数。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 在某些场景下我们需要同时从多个通道接收数据,这个时候就可以用到golang中给我们提供的select多路复用</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//1.定义一个管道 10个数据int</span></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//2.定义一个管道 5个数据string</span></span><br><span class="line">	stringChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">5</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		stringChan &lt;- <span class="string">&quot;hello&quot;</span> + fmt.Sprintf(<span class="string">&quot;%d&quot;</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用select来获取channel里面的数据的时候不需要关闭channel</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> v := &lt;-intChan:</span><br><span class="line">			fmt.Printf(<span class="string">&quot;从 intChan 读取的数据%d\n&quot;</span>, v)</span><br><span class="line">			time.Sleep(time.Millisecond * <span class="number">50</span>)</span><br><span class="line">		<span class="keyword">case</span> v := &lt;-stringChan:</span><br><span class="line">			fmt.Printf(<span class="string">&quot;从 stringChan 读取的数据%v\n&quot;</span>, v)</span><br><span class="line">			time.Sleep(time.Millisecond * <span class="number">50</span>)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Printf(<span class="string">&quot;数据获取完毕&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="comment">//注意退出...</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-6-并发安全和锁"><a href="#6-6-并发安全和锁" class="headerlink" title="6.6.并发安全和锁"></a>6.6.并发安全和锁</h2><h3 id="1-并发安全与锁"><a href="#1-并发安全与锁" class="headerlink" title="1.并发安全与锁"></a>1.并发安全与锁</h3><h4 id="1-1-并发安全"><a href="#1-1-并发安全" class="headerlink" title="1.1 并发安全"></a>1.1 并发安全</h4><ul>
<li>有时候在Go代码中可能会存在多个goroutine同时操作一个资源（临界区），这种情况会发生竞态问题（数据竞态）。</li>
<li>类比现实生活中的例子有十字路口被各个方向的的汽车竞争；还有火车上的卫生间被车厢里的人竞争。</li>
<li>下面开启两个协程，对变量x加一操作，分别加5000次，理想结果是10000，实际三次结果都不相同</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="type">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">		x = x + <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">第一次结果：6125</span></span><br><span class="line"><span class="comment">第二次结果：6217</span></span><br><span class="line"><span class="comment">第三次结果：10000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h4 id="1-2-互斥锁"><a href="#1-2-互斥锁" class="headerlink" title="1.2 互斥锁"></a>1.2 互斥锁</h4><ul>
<li>互斥锁是一种常用的控制共享资源访问的方法，它能够保证同时只有一个<code>goroutine</code>可以访问共享资源。</li>
<li>Go语言中使用<code>sync</code>包的<code>Mutex</code>类型来实现互斥锁。</li>
<li>使用互斥锁来修复上面代码的问题：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="type">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">		lock.Lock() <span class="comment">// 加锁</span></span><br><span class="line">		x = x + <span class="number">1</span></span><br><span class="line">		lock.Unlock() <span class="comment">// 解锁</span></span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(x)   <span class="comment">// 10000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-3-读写互斥锁"><a href="#1-3-读写互斥锁" class="headerlink" title="1.3 读写互斥锁"></a>1.3 读写互斥锁</h4><ul>
<li>互斥锁是完全互斥的，但是有很多实际的场景下是<code>读多写少的</code></li>
<li>当我们并发的去读取一个资源不涉及资源修改的时候是没有必要加锁的，这种场景下使用读写锁是更好的一种选择。</li>
<li>读写锁在Go语言中使用<code>sync</code>包中的<code>RWMutex</code>类型。</li>
<li>读写锁分为两种：读锁和写锁<ul>
<li>当一个goroutine获取读锁之后，其他的<code>goroutine</code>如果是获取读锁会继续获得锁，如果是获取写锁就会等待；</li>
<li>当一个<code>goroutine</code>获取写锁之后，其他的<code>goroutine</code>无论是获取读锁还是写锁都会等待。</li>
</ul>
</li>
<li><code>注意：</code>是<code>读写锁非常适合读多写少的场景</code>，如果读和写的操作差别不大，读写锁的优势就发挥不出来。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> mutex sync.RWMutex</span><br><span class="line"><span class="comment">//写的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span> &#123;</span><br><span class="line">	mutex.Lock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;执行写操作&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">	mutex.Unlock()</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">	mutex.RLock()</span><br><span class="line">	fmt.Println(<span class="string">&quot;---执行读操作&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">	mutex.RUnlock()</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;	<span class="comment">//开启10个协程执行读操作</span></span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> write()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;	<span class="comment">// 开启10个协程执行写操作</span></span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> read()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-sync其他方法"><a href="#2-sync其他方法" class="headerlink" title="2.sync其他方法"></a>2.sync其他方法</h3><h4 id="2-1-sync-WaitGroup"><a href="#2-1-sync-WaitGroup" class="headerlink" title="2.1 sync.WaitGroup"></a>2.1 sync.WaitGroup</h4><ul>
<li>在代码中生硬的使用<code>time.Sleep</code>肯定是不合适的，Go语言中可以使用<code>sync.WaitGroup</code>来实现并发任务的同步。</li>
<li><code>sync.WaitGroup</code>有以下几个方法：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">(wg * WaitGroup) Add(delta int)</td>
<td align="center">计数器+delta</td>
</tr>
<tr>
<td align="center">(wg *WaitGroup) Done()</td>
<td align="center">计数器-1</td>
</tr>
<tr>
<td align="center">(wg *WaitGroup) Wait()</td>
<td align="center">阻塞直到计数器变为0</td>
</tr>
</tbody></table>
<ul>
<li><code>sync.WaitGroup</code>内部维护着一个计数器，计数器的值可以增加和减少。</li>
<li>例如当我们启动了N 个并发任务时，就将计数器值增加N。</li>
<li>每个任务完成时通过调用Done()方法将计数器减1。</li>
<li>通过调用Wait()来等待并发任务执行完，当计数器值为0时，表示所有并发任务已经完成。</li>
<li>我们利用<code>sync.WaitGroup</code>将上面的代码优化一下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello Goroutine!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> hello() <span class="comment">// 启动另外一个goroutine去执行hello函数</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;main goroutine done!&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2sync-Once"><a href="#2-2sync-Once" class="headerlink" title="2.2sync.Once"></a>2.2sync.Once</h4><ul>
<li>在编程的很多场景下我们需要确保某些操作在高并发的场景下只执行一次，例如只加载一次配置文件、只关闭一次通道等。</li>
<li>Go语言中的<code>sync</code>包中提供了一个针对只执行一次场景的解决方案–<code>sync.Once</code>。</li>
<li><code>sync.Once</code>只有一个<code>Do</code>方法，其签名如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icons <span class="keyword">map</span>[<span class="type">string</span>]image.Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loadIconsOnce sync.Once</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">	icons = <span class="keyword">map</span>[<span class="type">string</span>]image.Image&#123;</span><br><span class="line">		<span class="string">&quot;left&quot;</span>:  loadIcon(<span class="string">&quot;left.png&quot;</span>),</span><br><span class="line">		<span class="string">&quot;up&quot;</span>:    loadIcon(<span class="string">&quot;up.png&quot;</span>),</span><br><span class="line">		<span class="string">&quot;right&quot;</span>: loadIcon(<span class="string">&quot;right.png&quot;</span>),</span><br><span class="line">		<span class="string">&quot;down&quot;</span>:  loadIcon(<span class="string">&quot;down.png&quot;</span>),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Icon 是并发安全的</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Icon</span><span class="params">(name <span class="type">string</span>)</span></span> image.Image &#123;</span><br><span class="line">	loadIconsOnce.Do(loadIcons)</span><br><span class="line">	<span class="keyword">return</span> icons[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-3-sync-Map"><a href="#2-3-sync-Map" class="headerlink" title="2.3 sync.Map"></a>2.3 sync.Map</h4><ul>
<li>Go语言中内置的map不是并发安全的。请看下面的示例</li>
<li>下面的代码开启少量几个<code>goroutine</code>的时候可能没什么问题</li>
<li>当并发多了之后执行上面的代码就会报<code>fatal error: concurrent map writes</code>错误。</li>
<li>原因：<ul>
<li>因为 map 变量为 指针类型变量，并发写时，多个协程同时操作一个内存</li>
<li>类似于多线程操作同一个资源会发生竞争关系，共享资源会遭到破坏</li>
<li>因此golang 出于安全的考虑，抛出致命错误：fatal error: concurrent map writes。</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(key <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(key <span class="type">string</span>, value <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	m[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">			key := strconv.Itoa(n)</span><br><span class="line">			set(key, n)</span><br><span class="line">			fmt.Printf(<span class="string">&quot;k=:%v,v:=%v\n&quot;</span>, key, get(key))</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>像这种场景下就需要为map加锁来保证并发的安全性了，Go语言的<code>sync</code>包中提供了一个开箱即用的并发安全版map–<code>sync.Map</code>。</li>
<li>开箱即用表示不用像内置的map一样使用make函数初始化就能直接使用。</li>
<li>同时<code>sync.Map</code>内置了诸如<code>Store</code>、<code>Load</code>、<code>LoadOrStore</code>、<code>Delete</code>、<code>Range</code>等操作方法。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = sync.Map&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">			key := strconv.Itoa(n)</span><br><span class="line">			m.Store(key, n)</span><br><span class="line">			value, _ := m.Load(key)</span><br><span class="line">			fmt.Printf(<span class="string">&quot;k=:%v,v:=%v\n&quot;</span>, key, value)</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-7-goroutine原理"><a href="#6-7-goroutine原理" class="headerlink" title="6.7.goroutine原理"></a>6.7.goroutine原理</h2><h3 id="1-设计思路"><a href="#1-设计思路" class="headerlink" title="1.设计思路"></a>1.设计思路</h3><ul>
<li><a target="_blank" rel="noopener" href="https://strikefreedom.top/high-performance-implementation-of-goroutine-pool">参考博客</a></li>
<li><a target="_blank" rel="noopener" href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-goroutine/#651-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E7%90%86">goroutine</a></li>
</ul>
<h4 id="1-1-设计描述"><a href="#1-1-设计描述" class="headerlink" title="1.1 设计描述"></a>1.1 设计描述</h4><ul>
<li>启动服务之时先初始化一个 Goroutine Pool 池，这个 Pool 维护了一个类似栈的 LIFO 队列 ，里面存放负责处理任务的 Worker</li>
<li>然后在 client 端提交 task 到 Pool 中之后，在 Pool 内部，接收 task 之后的核心操作是<ul>
<li>检查当前 Worker 队列中是否有可用的 Worker，如果有，取出执行当前的 task；</li>
<li>没有可用的 Worker，判断当前在运行的 Worker 是否已超过该 Pool 的容量</li>
<li>每个 Worker 执行完任务之后，放回 Pool 的队列中等待</li>
</ul>
</li>
</ul>
<p><img src="/images/image-20220111110347525.04783d49.png" alt="img"></p>
<h4 id="1-2-Pool-struct"><a href="#1-2-Pool-struct" class="headerlink" title="1.2 Pool struct"></a>1.2 Pool struct</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> sig <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> f <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pool从客户端获取任务，它限制goroutines总数，并且回收再使用</span></span><br><span class="line"><span class="keyword">type</span> Pool <span class="keyword">struct</span> &#123;</span><br><span class="line">	capacity <span class="type">int32</span>                   <span class="comment">// 协程池容量</span></span><br><span class="line">	running <span class="type">int32</span>                    <span class="comment">// 正在运行的goroutine数量</span></span><br><span class="line">	expiryDuration time.Duration     <span class="comment">// 为每个worker设置一个过期时间</span></span><br><span class="line">	workers []*Worker                <span class="comment">// 存放空闲 worker,请求进入 Pool先检查workers若有则取出绑定任务执行</span></span><br><span class="line">	release <span class="keyword">chan</span> sig                 <span class="comment">// 当关闭该 Pool 支持通知所有 worker 退出运行以防 goroutine 泄露</span></span><br><span class="line">	lock sync.Mutex                  <span class="comment">// 同步操作锁</span></span><br><span class="line">	once sync.Once                   <span class="comment">// 确保 Pool 关闭操作只会执行一次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-初始化-Pool-并启动定期清理过期-worker-任务"><a href="#1-3-初始化-Pool-并启动定期清理过期-worker-任务" class="headerlink" title="1.3 初始化 Pool 并启动定期清理过期 worker 任务"></a>1.3 初始化 Pool 并启动定期清理过期 worker 任务</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建一个线程池实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPool</span><span class="params">(size <span class="type">int</span>)</span></span> (*Pool, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> NewTimingPool(size, DefaultCleanIntervalTime)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 产生一个带有自定义定时器的线程池实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTimingPool</span><span class="params">(size, expiry <span class="type">int</span>)</span></span> (*Pool, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> size &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, ErrInvalidPoolSize</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> expiry &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, ErrInvalidPoolExpiry</span><br><span class="line">	&#125;</span><br><span class="line">	p := &amp;Pool&#123;</span><br><span class="line">		capacity:       <span class="type">int32</span>(size),</span><br><span class="line">		freeSignal:     <span class="built_in">make</span>(<span class="keyword">chan</span> sig, math.MaxInt32),</span><br><span class="line">		release:        <span class="built_in">make</span>(<span class="keyword">chan</span> sig, <span class="number">1</span>),</span><br><span class="line">		expiryDuration: time.Duration(expiry) * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 启动定期清理过期worker任务，独立goroutine运行，进一步节省系统资源</span></span><br><span class="line">	p.monitorAndClear()</span><br><span class="line">	<span class="keyword">return</span> p, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-提交任务到-Pool"><a href="#1-4-提交任务到-Pool" class="headerlink" title="1.4 提交任务到 Pool"></a>1.4 提交任务到 Pool</h4><ul>
<li>第一个 if 判断当前 Pool 是否已被关闭，若是则不再接受新任务，否则获取一个 Pool 中可用的 worker，绑定该 <code>task</code> 执行。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Submit submit a task to pool</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pool)</span></span> Submit(task f) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(p.release) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> ErrPoolClosed</span><br><span class="line">	&#125;</span><br><span class="line">	w := p.getWorker()</span><br><span class="line">	w.task &lt;- task</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-5-获取可用-worker-核心"><a href="#1-5-获取可用-worker-核心" class="headerlink" title="1.5 获取可用 worker(核心)"></a>1.5 获取可用 worker(核心)</h4><ul>
<li><code>p.getWorker()</code> 源码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个可用的worker来运行这些任务。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pool)</span></span> getWorker() *Worker &#123;</span><br><span class="line">	<span class="keyword">var</span> w *Worker</span><br><span class="line">	waiting := <span class="literal">false</span>	<span class="comment">// 标志变量，判断当前正在运行的worker数量是否已到达Pool的容量上限</span></span><br><span class="line">	p.lock.Lock()	   <span class="comment">// 加锁，检测队列中是否有可用worker，并进行相应操作</span></span><br><span class="line">	idleWorkers := p.workers</span><br><span class="line">	n := <span class="built_in">len</span>(idleWorkers) - <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;	 <span class="comment">// 当前队列中无可用worker</span></span><br><span class="line">		<span class="comment">// 判断运行worker数目已达到该Pool的容量上限，置等待标志</span></span><br><span class="line">		waiting = p.Running() &gt;= p.Cap()</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;		<span class="comment">// 当前队列有可用worker，从队列尾部取出一个使用</span></span><br><span class="line">		w = idleWorkers[n]</span><br><span class="line">		idleWorkers[n] = <span class="literal">nil</span></span><br><span class="line">		p.workers = idleWorkers[:n]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	p.lock.Unlock()	  <span class="comment">// 检测完成，解锁</span></span><br><span class="line">	<span class="keyword">if</span> waiting &#123;	 <span class="comment">// Pool容量已满，新请求等待</span></span><br><span class="line">		<span class="keyword">for</span> &#123;		 <span class="comment">// 利用锁阻塞等待直到有空闲worker</span></span><br><span class="line">			p.lock.Lock()</span><br><span class="line">			idleWorkers = p.workers</span><br><span class="line">			l := <span class="built_in">len</span>(idleWorkers) - <span class="number">1</span></span><br><span class="line">			<span class="keyword">if</span> l &lt; <span class="number">0</span> &#123;</span><br><span class="line">				p.lock.Unlock()</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			w = idleWorkers[l]</span><br><span class="line">			idleWorkers[l] = <span class="literal">nil</span></span><br><span class="line">			p.workers = idleWorkers[:l]</span><br><span class="line">			p.lock.Unlock()</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 当前无空闲worker但是Pool还没有满，则可以直接新开一个worker执行任务</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> w == <span class="literal">nil</span> &#123;</span><br><span class="line">		w = &amp;Worker&#123;</span><br><span class="line">			pool: p,</span><br><span class="line">			task: <span class="built_in">make</span>(<span class="keyword">chan</span> f, <span class="number">1</span>),</span><br><span class="line">		&#125;</span><br><span class="line">		w.run()</span><br><span class="line">		<span class="comment">// 运行worker数加一</span></span><br><span class="line">		p.incRunning()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> w</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-6-执行任务"><a href="#1-6-执行任务" class="headerlink" title="1.6 执行任务"></a>1.6 执行任务</h4><ul>
<li>结合前面的 <code>p.Submit(task f)</code> 和 <code>p.getWorker()</code> ，提交任务到 Pool 之后，获取一个可用 worker</li>
<li>每新建一个 worker 实例之时都需要调用 <code>w.run()</code> 启动一个 goroutine 监听 worker 的任务列表 <code>task</code> ，一有任务提交进来就执行；</li>
<li>所以，当调用 worker 的 <code>sendTask(task f)</code> 方法提交任务到 worker 的任务队列之后，马上就可以被接收并执行</li>
<li>当任务执行完之后，会调用 <code>w.pool.putWorker(w *Worker)</code> 方法将这个已经执行完任务的 worker 从当前任务解绑放回 Pool 中，以供下个任务可以使用</li>
<li>至此，一个任务从提交到完成的过程就此结束，Pool 调度将进入下一个循环。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Worker是运行任务的实际执行者，它启动一个接受任务并执行函数调用的goroutine</span></span><br><span class="line"><span class="keyword">type</span> Worker <span class="keyword">struct</span> &#123;</span><br><span class="line">	pool *Pool   <span class="comment">// 每个pool对应一个worker</span></span><br><span class="line">	task <span class="keyword">chan</span> f  <span class="comment">// 任务是一项应该完成的工作</span></span><br><span class="line">	recycleTime time.Time	 <span class="comment">// 当将一个worker放回队列时，recycleTime将被更新。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run启动一个goroutine以重复执行函数调用的过程</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span></span> run() &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// 循环监听任务列表，一旦有任务立马取出运行</span></span><br><span class="line">		<span class="keyword">for</span> f := <span class="keyword">range</span> w.task &#123;</span><br><span class="line">			<span class="keyword">if</span> f == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="comment">// 退出goroutine，运行worker数减一</span></span><br><span class="line">				w.pool.decRunning()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			f()</span><br><span class="line">			<span class="comment">// worker回收复用</span></span><br><span class="line">			w.pool.putWorker(w)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-7-worker回收-goroutine-复用"><a href="#1-7-worker回收-goroutine-复用" class="headerlink" title="1.7 worker回收(goroutine 复用)"></a>1.7 worker回收(goroutine 复用)</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// putWorker将一个worker放回空闲池，回收goroutines</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pool)</span></span> putWorker(worker *Worker) &#123;</span><br><span class="line">	<span class="comment">// 写入回收时间，亦即该worker的最后一次结束运行的时间</span></span><br><span class="line">	worker.recycleTime = time.Now()</span><br><span class="line">	p.lock.Lock()</span><br><span class="line">	p.workers = <span class="built_in">append</span>(p.workers, worker)</span><br><span class="line">	p.lock.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-8-动态扩容或者缩小池容量"><a href="#1-8-动态扩容或者缩小池容量" class="headerlink" title="1.8 动态扩容或者缩小池容量"></a>1.8 动态扩容或者缩小池容量</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReSize更改此池的容量</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pool)</span></span> ReSize(size <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> size == p.Cap() &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	atomic.StoreInt32(&amp;p.capacity, <span class="type">int32</span>(size))</span><br><span class="line">	diff := p.Running() - size</span><br><span class="line">	<span class="keyword">if</span> diff &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; diff; i++ &#123;</span><br><span class="line">			p.getWorker().task &lt;- <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-9-定期清理过期-Worker"><a href="#1-9-定期清理过期-Worker" class="headerlink" title="1.9 定期清理过期 Worker"></a>1.9 定期清理过期 Worker</h4><ul>
<li>定期检查空闲 worker 队列中是否有已过期的 worker 并清理</li>
<li>因为采用了 LIFO 后进先出队列存放空闲 worker，所以该队列默认已经是按照 worker 的最后运行时间由远及近排序</li>
<li>可以方便地按顺序取出空闲队列中的每个 worker 并判断它们的最后运行时间与当前时间之差是否超过设置的过期时长</li>
<li>若是，则清理掉该 goroutine，释放该 worker，并且将剩下的未过期 worker 重新分配到当前 Pool 的空闲 worker 队列中，进一步节省系统资源</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  定期清理过期 Worker</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pool)</span></span> periodicallyPurge() &#123;</span><br><span class="line">	heartbeat := time.NewTicker(p.expiryDuration)</span><br><span class="line">	<span class="keyword">for</span> <span class="keyword">range</span> heartbeat.C &#123;</span><br><span class="line">		currentTime := time.Now()</span><br><span class="line">		p.lock.Lock()</span><br><span class="line">		idleWorkers := p.workers</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(idleWorkers) == <span class="number">0</span> &amp;&amp; p.Running() == <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(p.release) &gt; <span class="number">0</span> &#123;</span><br><span class="line">			p.lock.Unlock()</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		n := <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> i, w := <span class="keyword">range</span> idleWorkers &#123;</span><br><span class="line">			<span class="keyword">if</span> currentTime.Sub(w.recycleTime) &lt;= p.expiryDuration &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			n = i</span><br><span class="line">			w.task &lt;- <span class="literal">nil</span></span><br><span class="line">			idleWorkers[i] = <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">		n++</span><br><span class="line">		<span class="keyword">if</span> n &gt;= <span class="built_in">len</span>(idleWorkers) &#123;</span><br><span class="line">			p.workers = idleWorkers[:<span class="number">0</span>]</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			p.workers = idleWorkers[n:]</span><br><span class="line">		&#125;</span><br><span class="line">		p.lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-pool使用"><a href="#2-pool使用" class="headerlink" title="2.pool使用"></a>2.pool使用</h3><h4 id="2-1-公共池"><a href="#2-1-公共池" class="headerlink" title="2.1 公共池"></a>2.1 公共池</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/panjf2000/ants/v2&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demoFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Millisecond)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 在retrieveWorker()中可能有一些调用者在等待，因此我们需要唤醒它们来防止那些无限阻塞的调用者</span></span><br><span class="line">	<span class="keyword">defer</span> ants.Release()</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	syncCalculateSum := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		demoFunc()</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		_ = ants.Submit(syncCalculateSum)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Printf(<span class="string">&quot;running goroutines: %d\n&quot;</span>, ants.Running())</span><br><span class="line">	fmt.Printf(<span class="string">&quot;finish all tasks.\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Hello World!</span></span><br><span class="line"><span class="comment">	Hello World!</span></span><br><span class="line"><span class="comment">	running goroutines: 1000</span></span><br><span class="line"><span class="comment">	finish all tasks.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h4 id="2-2-方法绑定池"><a href="#2-2-方法绑定池" class="headerlink" title="2.2 方法绑定池"></a>2.2 方法绑定池</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/panjf2000/ants/v2&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunc</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;run with %d\n&quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> ants.Release()</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="comment">// 使用池和函数，设置goroutine pool的容量为10，超时时间为1秒。</span></span><br><span class="line">	p, _ := ants.NewPoolWithFunc(<span class="number">10</span>, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">		myFunc(i)</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">defer</span> p.Release()</span><br><span class="line">	<span class="comment">// 逐个提交任务</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		_ = p.Invoke(<span class="type">int32</span>(i))</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Printf(<span class="string">&quot;running goroutines: %d\n&quot;</span>, p.Running())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">run with 976</span></span><br><span class="line"><span class="comment">run with 990</span></span><br><span class="line"><span class="comment">run with 971</span></span><br><span class="line"><span class="comment">running goroutines: 10</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h1 id="七、常用模块"><a href="#七、常用模块" class="headerlink" title="七、常用模块"></a>七、常用模块</h1><h2 id="一、fmt"><a href="#一、fmt" class="headerlink" title="一、fmt"></a>一、fmt</h2><h3 id="1-1-常用占位符"><a href="#1-1-常用占位符" class="headerlink" title="1.1 常用占位符"></a>1.1 常用占位符</h3><table>
<thead>
<tr>
<th>动词</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>%v</td>
<td>按值的本来值输出</td>
</tr>
<tr>
<td>%+v</td>
<td>在 %v 的基础上，对结构体字段名和值进行展开</td>
</tr>
<tr>
<td>%#v</td>
<td>输出 Go 语言语法格式的值</td>
</tr>
<tr>
<td>%T</td>
<td>输出 Go 语言语法格式的类型和值</td>
</tr>
<tr>
<td>%%</td>
<td>输出 %% 本体</td>
</tr>
<tr>
<td>%b</td>
<td>整型以二进制方式显示</td>
</tr>
<tr>
<td>%o</td>
<td>整型以八进制方式显示</td>
</tr>
<tr>
<td>%d</td>
<td>整型以十进制方式显示</td>
</tr>
<tr>
<td>%x</td>
<td>整型以 十六进制显示</td>
</tr>
<tr>
<td>%X</td>
<td>整型以十六进制、字母大写方式显示</td>
</tr>
<tr>
<td>%U</td>
<td>Unicode 字符</td>
</tr>
<tr>
<td>%f</td>
<td>浮点数</td>
</tr>
<tr>
<td>%p</td>
<td>指针，十六进制方式显示</td>
</tr>
</tbody></table>
<h3 id="1-2-Print"><a href="#1-2-Print" class="headerlink" title="1.2 Print"></a>1.2 Print</h3><ul>
<li><p>Println：</p>
<ul>
<li>一次输入多个值的时候 Println 中间有空格</li>
<li>Println 会自动换行，Print 不会</li>
</ul>
</li>
<li><p>Print：</p>
<ul>
<li>一次输入多个值的时候 Print 没有 中间有空格 </li>
<li>Print 不会自动换行</li>
</ul>
</li>
<li><p>Printf </p>
<ul>
<li>是格式化输出，在很多场景下比 Println 更方便</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Print(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;wangwu&quot;</span>)   <span class="comment">// zhangsanlisiwangwu</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;wangwu&quot;</span>) <span class="comment">// zhangsan lisi wangwu</span></span><br><span class="line"></span><br><span class="line">    name := <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">    age := <span class="number">20</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%s 今年 %d 岁\n&quot;</span>, name, age)     <span class="comment">// zhangsan 今年 20 岁</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;值：%v --&gt; 类型: %T&quot;</span>, name, name) <span class="comment">// 值：zhangsan --&gt; 类型: string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-Sprint"><a href="#1-3-Sprint" class="headerlink" title="1.3 Sprint"></a>1.3 Sprint</h3><ul>
<li>Sprint系列函数会把传入的数据生成并返回一个字符串。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := fmt.Sprint(<span class="string">&quot;枯藤&quot;</span>)</span><br><span class="line">    fmt.Println(s1) <span class="comment">// 枯藤</span></span><br><span class="line">    name := <span class="string">&quot;枯藤&quot;</span></span><br><span class="line">    age := <span class="number">18</span></span><br><span class="line">    s2 := fmt.Sprintf(<span class="string">&quot;name:%s,age:%d&quot;</span>, name, age) <span class="comment">// name:枯藤,age:18</span></span><br><span class="line">    fmt.Println(s2)</span><br><span class="line">    s3 := fmt.Sprintln(<span class="string">&quot;枯藤&quot;</span>) <span class="comment">// 枯藤 有空格</span></span><br><span class="line">    fmt.Println(s3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="二、time"><a href="#二、time" class="headerlink" title="二、time"></a>二、time</h2><h3 id="2-1-时间类型"><a href="#2-1-时间类型" class="headerlink" title="2.1 时间类型"></a>2.1 时间类型</h3><ul>
<li>我们可以通过 time.Now()函数获取当前的时间对象，然后获取时间对象的年月日时分秒等信息。</li>
<li>注意：%02d 中的 2 表示宽度，如果整数不够 2 列就补上 0</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    now := time.Now()   <span class="comment">//获取当前时间</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;current time:%v\n&quot;</span>, now)</span><br><span class="line">    </span><br><span class="line">    year := now.Year()     <span class="comment">//年</span></span><br><span class="line">    month := now.Month()   <span class="comment">//月</span></span><br><span class="line">    day := now.Day()       <span class="comment">//日</span></span><br><span class="line">    hour := now.Hour()        <span class="comment">//小时</span></span><br><span class="line">    minute := now.Minute()     <span class="comment">//分钟</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-2-时间戳"><a href="#2-2-时间戳" class="headerlink" title="2.2 时间戳"></a>2.2 时间戳</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    now := time.Now()            <span class="comment">//获取当前时间</span></span><br><span class="line">    timestamp1 := now.Unix()     <span class="comment">//时间戳</span></span><br><span class="line">    timestamp2 := now.UnixNano() <span class="comment">//纳秒时间戳</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;current timestamp1:%v\n&quot;</span>, timestamp1)  <span class="comment">// current </span></span><br><span class="line">timestamp1:<span class="number">1623560753</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;current timestamp2:%v\n&quot;</span>, timestamp2)  <span class="comment">// current </span></span><br><span class="line">timestamp2:<span class="number">1623560753965606600</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用time.Unix() 函数可以将时间戳转为时间格式</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timestampDemo2</span><span class="params">(timestamp <span class="type">int64</span>)</span></span> &#123;</span><br><span class="line">    timeObj := time.Unix(timestamp, <span class="number">0</span>) <span class="comment">//将时间戳转为时间格式</span></span><br><span class="line">    fmt.Println(timeObj)</span><br><span class="line">    year := timeObj.Year()     <span class="comment">//年</span></span><br><span class="line">    month := timeObj.Month()   <span class="comment">//月</span></span><br><span class="line">    day := timeObj.Day()       <span class="comment">//日</span></span><br><span class="line">    hour := timeObj.Hour()     <span class="comment">//小时</span></span><br><span class="line">    minute := timeObj.Minute()  <span class="comment">//分钟</span></span><br><span class="line">    second := timeObj.Second()  <span class="comment">//秒</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d-%02d-%02d %02d:%02d:%02d\n&quot;</span>, year, month, day, hour, minute, </span><br><span class="line">second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-时间间隔"><a href="#2-3-时间间隔" class="headerlink" title="2.3 时间间隔"></a>2.3 时间间隔</h3><ul>
<li>time.Duration 是time 包定义的一个类型，它代表两个时间点之间经过的时间，以纳秒为单<br>位。</li>
<li>time.Duration 表示一段时间间隔，可表示的最长时间段大约290年。</li>
<li>time包中定义的时间间隔类型的常量如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    Nanosecond  Duration = <span class="number">1</span></span><br><span class="line">    Microsecond          = <span class="number">1000</span> * Nanosecond</span><br><span class="line">    Millisecond          = <span class="number">1000</span> * Microsecond</span><br><span class="line">    Second               = <span class="number">1000</span> * Millisecond</span><br><span class="line">    Minute               = <span class="number">60</span> * Second</span><br><span class="line">    Hour                 = <span class="number">60</span> * Minute</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="2-4-时间格式化"><a href="#2-4-时间格式化" class="headerlink" title="2.4 时间格式化"></a>2.4 时间格式化</h3><ul>
<li>时间类型有一个自带的方法Format 进行格式化</li>
<li>需要注意的是Go语言中格式化时间模板不是常见的Y-m-d H:M:S</li>
<li>而是使用Go的诞生时间2006年1月2号15点04分（记忆口诀为2006 1 2 3 4）。</li>
<li>补充：如果想格式化为12小时方式，需指定PM 。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    now := time.Now()</span><br><span class="line">    <span class="comment">// 格式化的模板为Go的出生时间2006年1月2号15点04分 Mon Jan</span></span><br><span class="line">    fmt.Println(now.Format(<span class="string">&quot;2006-01-02 15:04:05.000 Mon Jan&quot;</span>)) <span class="comment">// 2021-06-13 </span></span><br><span class="line"><span class="number">13</span>:<span class="number">10</span>:<span class="number">18.143</span> Sun Jun</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>字符串转时间类型</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    loc, _ := time.LoadLocation(<span class="string">&quot;Asia/Shanghai&quot;</span>)</span><br><span class="line">    <span class="comment">// 按照指定时区和指定格式解析字符串时间</span></span><br><span class="line">    timeObj, err := time.ParseInLocation(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>, <span class="string">&quot;2019-08-04 14:15:20&quot;</span>, </span><br><span class="line">loc)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(timeObj) <span class="comment">// 2019-08-04 14:15:20 +0800 CST</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-时间操作函数"><a href="#2-5-时间操作函数" class="headerlink" title="2.5 时间操作函数"></a>2.5 时间操作函数</h3><ul>
<li>Add<ul>
<li>我们在日常的编码过程中可能会遇到要求时间+时间间隔的需求</li>
<li>Go 语言的时间对象有提供Add 方法如下</li>
</ul>
</li>
<li>Sub<ul>
<li>求两个时间之间的差值</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="三、encoding-json包"><a href="#三、encoding-json包" class="headerlink" title="三、encoding-json包"></a>三、encoding-json包</h2><h3 id="3-1-struct与json"><a href="#3-1-struct与json" class="headerlink" title="3.1 struct与json"></a>3.1 struct与json</h3><ul>
<li>比如我们 Golang 要给 App 或者小程序提供 Api 接口数据，这个时候就需要涉及到结构体和Json 之间的相互转换</li>
<li><strong>GolangJSON</strong> 序列化是指把结构体数据转化成 JSON 格式的字符串</li>
<li><strong>Golang</strong> <strong>JSON</strong> 的反序列化是指把 JSON 数据转化成 Golang 中的结构体对象</li>
<li>Golang 中 的 序 列 化 和 反 序 列 化 主 要 通 过 &quot;encoding/json&quot; 包 中 的 json.Marshal() 和 json.Unmarshal()方法实现</li>
</ul>
<h4 id="1、struct转Json字符串"><a href="#1、struct转Json字符串" class="headerlink" title="1、struct转Json字符串"></a>1、struct转Json字符串</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="type">int</span></span><br><span class="line">    Gender <span class="type">string</span></span><br><span class="line">    name <span class="type">string</span>     <span class="comment">//私有属性不能被 json 包访问</span></span><br><span class="line">    Sno <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s1 = Student&#123;</span><br><span class="line">        ID: <span class="number">1</span>,</span><br><span class="line">        Gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        name: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">        Sno: <span class="string">&quot;s0001&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, s1)  <span class="comment">// main.Student&#123;ID:1, Gender:&quot;男&quot;, name:&quot;李四&quot;, </span></span><br><span class="line">Sno:<span class="string">&quot;s0001&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> s, _ = json.Marshal(s1)</span><br><span class="line">    jsonStr := <span class="type">string</span>(s)</span><br><span class="line">    fmt.Println(jsonStr)   <span class="comment">// &#123;&quot;ID&quot;:1,&quot;Gender&quot;:&quot;男&quot;,&quot;Sno&quot;:&quot;s0001&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2、Json字符串转struct"><a href="#2、Json字符串转struct" class="headerlink" title="2、Json字符串转struct"></a>2、Json字符串转struct</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="type">int</span></span><br><span class="line">    Gender <span class="type">string</span></span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Sno <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> jsonStr = <span class="string">`&#123;&quot;ID&quot;:1,&quot;Gender&quot;:&quot;男&quot;,&quot;Name&quot;:&quot;李四&quot;,&quot;Sno&quot;:&quot;s0001&quot;&#125;`</span></span><br><span class="line">    <span class="keyword">var</span> student Student   <span class="comment">//定义一个 Monster 实例</span></span><br><span class="line">    err := json.Unmarshal([]<span class="type">byte</span>(jsonStr), &amp;student)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;unmarshal err=%v\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 反序列化后 student=main.Student&#123;ID:1, Gender:&quot;男&quot;, Name:&quot;李四&quot;, Sno:&quot;s0001&quot;&#125; </span></span><br><span class="line">student.Name=李四 </span><br><span class="line">    fmt.Printf(<span class="string">&quot;反序列化后 student=%#v student.Name=%v \n&quot;</span>, student, student.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-2-struct-tag"><a href="#3-2-struct-tag" class="headerlink" title="3.2 struct tag"></a>3.2 struct tag</h3><h4 id="1、Tag标签说明"><a href="#1、Tag标签说明" class="headerlink" title="1、Tag标签说明"></a>1、Tag标签说明</h4><ul>
<li>Tag 是结构体的元信息，可以在运行的时候通过反射的机制读取出来。</li>
<li>Tag 在结构体字段的后方定义，由一对反引号包裹起来</li>
<li>具体的格式如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key1:<span class="string">&quot;value1&quot;</span> key2:<span class="string">&quot;value2&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>结构体 tag 由一个或多个键值对组成。键与值使用冒号分隔，值用双引号括起来。</li>
<li>同一个结构体字段可以设置多个键值对 tag，不同的键值对之间使用空格分隔。</li>
<li>注意事项： <ul>
<li>为结构体编写 Tag 时，必须严格遵守键值对的规则。</li>
<li>结构体标签的解析代码的容错能力很差，一旦格式写错，编译和运行时都不会提示任何错误，<br>通过反射也无法正确取值。</li>
<li>例如不要在 key 和 value 之间添加空格。</li>
</ul>
</li>
</ul>
<h4 id="2、Tag结构体转化Json字符串"><a href="#2、Tag结构体转化Json字符串" class="headerlink" title="2、Tag结构体转化Json字符串"></a>2、Tag结构体转化Json字符串</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="type">int</span> <span class="string">`json:&quot;id&quot;`</span>       <span class="comment">//通过指定 tag 实现 json 序列化该字段时的 key</span></span><br><span class="line">    Gender <span class="type">string</span> <span class="string">`json:&quot;gender&quot;`</span></span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Sno <span class="type">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3、Json字符串转成Tag结构体"><a href="#3、Json字符串转成Tag结构体" class="headerlink" title="3、Json字符串转成Tag结构体"></a>3、Json字符串转成Tag结构体</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="type">int</span> <span class="string">`json:&quot;id&quot;`</span> <span class="comment">//通过指定 tag 实现 json 序列化该字段时的 key</span></span><br><span class="line">    Gender <span class="type">string</span> <span class="string">`json:&quot;gender&quot;`</span></span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Sno <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s2 Student</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">`&#123;&quot;id&quot;:1,&quot;gender&quot;:&quot;男&quot;,&quot;Name&quot;:&quot;李四&quot;,&quot;Sno&quot;:&quot;s0001&quot;&#125;`</span></span><br><span class="line">    err := json.Unmarshal([]<span class="type">byte</span>(str), &amp;s2)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// main.Student&#123;ID:1, Gender:&quot;男&quot;, Name:&quot;李四&quot;, Sno:&quot;s0001&quot;&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v&quot;</span>, s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="四、Flag"><a href="#四、Flag" class="headerlink" title="四、Flag"></a>四、Flag</h2><h3 id="4-1-Flag"><a href="#4-1-Flag" class="headerlink" title="4.1 Flag"></a>4.1 Flag</h3><ul>
<li>Go语言内置的flag包实现了命令行参数的解析，flag包使得开发命令行工具更为简单。</li>
</ul>
<h4 id="flag-Parse"><a href="#flag-Parse" class="headerlink" title="flag.Parse()"></a>flag.Parse()</h4><p>通过以上两种方法定义好命令行flag参数后，需要通过调用flag.Parse()来对命令行参数进行解析。</p>
<p>支持的命令行参数格式有以下几种：</p>
<ul>
<li><p>-flag xxx （使用空格，一个-符号）</p>
</li>
<li><p>–flag xxx （使用空格，两个-符号）</p>
</li>
<li><p>-flag=xxx （使用等号，一个-符号）</p>
</li>
<li><p>–flag=xxx （使用等号，两个-符号）</p>
</li>
</ul>
<p>其中，布尔类型的参数必须使用等号的方式指定。</p>
<p>Flag解析在第一个非flag参数（单个”-“不是flag参数）之前停止，或者在终止符”–”之后停止。</p>
<h4 id="2、其他函数"><a href="#2、其他函数" class="headerlink" title="2、其他函数"></a>2、其他函数</h4><ul>
<li><p>flag.Args() ////返回命令行参数后的其他参数，以[]string类型 </p>
</li>
<li><p>flag.NArg() //返回命令行参数后的其他参数个数</p>
</li>
<li><p>flag.NFlag() //返回使用的命令行参数个数</p>
</li>
</ul>
<h3 id="4-2-完整示例"><a href="#4-2-完整示例" class="headerlink" title="4.2 完整示例"></a>4.2 完整示例</h3><h4 id="1、main-go"><a href="#1、main-go" class="headerlink" title="1、main.go"></a>1、main.go</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;flag&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//定义命令行参数方式1</span></span><br><span class="line">    <span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">    <span class="keyword">var</span> age <span class="type">int</span></span><br><span class="line">    <span class="keyword">var</span> married <span class="type">bool</span></span><br><span class="line">    <span class="keyword">var</span> delay time.Duration</span><br><span class="line">    flag.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;姓名&quot;</span>)</span><br><span class="line">    flag.IntVar(&amp;age, <span class="string">&quot;age&quot;</span>, <span class="number">18</span>, <span class="string">&quot;年龄&quot;</span>)</span><br><span class="line">    flag.BoolVar(&amp;married, <span class="string">&quot;married&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;婚否&quot;</span>)</span><br><span class="line">    flag.DurationVar(&amp;delay, <span class="string">&quot;d&quot;</span>, <span class="number">0</span>, <span class="string">&quot;延迟的时间间隔&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析命令行参数</span></span><br><span class="line">    flag.Parse()</span><br><span class="line">    fmt.Println(name, age, married, delay)</span><br><span class="line">    <span class="comment">//返回命令行参数后的其他参数</span></span><br><span class="line">    fmt.Println(flag.Args())</span><br><span class="line">    <span class="comment">//返回命令行参数后的其他参数个数</span></span><br><span class="line">    fmt.Println(flag.NArg())</span><br><span class="line">    <span class="comment">//返回使用的命令行参数个数</span></span><br><span class="line">    fmt.Println(flag.NFlag())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、查看帮助"><a href="#2、查看帮助" class="headerlink" title="2、查看帮助"></a>2、查看帮助</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\aaa\gin_demo&gt;  <span class="keyword">go</span> run main.<span class="keyword">go</span> --help</span><br><span class="line">  -age <span class="type">int</span></span><br><span class="line">        年龄 (<span class="keyword">default</span> <span class="number">18</span>)</span><br><span class="line">  -d duration</span><br><span class="line">        延迟的时间间隔</span><br><span class="line">  -married</span><br><span class="line">        婚否</span><br><span class="line">  -name <span class="type">string</span></span><br><span class="line">        姓名 (<span class="keyword">default</span> <span class="string">&quot;张三&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3、flag参数演示"><a href="#3、flag参数演示" class="headerlink" title="3、flag参数演示"></a>3、flag参数演示</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\aaa\gin_demo&gt;  <span class="keyword">go</span> run main.<span class="keyword">go</span> -name pprof --age <span class="number">28</span> -married=<span class="literal">false</span> -d=<span class="number">1</span>h30m</span><br><span class="line">pprof <span class="number">28</span> <span class="literal">false</span> <span class="number">1</span>h30m0s</span><br><span class="line">[]</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<h4 id="4、非flag命令行参数"><a href="#4、非flag命令行参数" class="headerlink" title="4、非flag命令行参数"></a>4、非flag命令行参数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\aaa\gin_demo&gt;<span class="keyword">go</span> run main.<span class="keyword">go</span> a b c</span><br><span class="line">张三 <span class="number">18</span> <span class="literal">false</span> <span class="number">0</span>s</span><br><span class="line">[a b c]</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/go/" rel="tag"># go</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/06/go/Go%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" rel="prev" title="Go快速入门.md">
      <i class="fa fa-chevron-left"></i> Go快速入门.md
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/06/go/GinWeb%E6%A1%86%E6%9E%B6-%E4%B8%8A%E7%AF%87/" rel="next" title="Gin Web框架-上篇.md">
      Gin Web框架-上篇.md <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9AGo-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%8B%E7%AF%87%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">第一阶段：Go 快速入门（下篇）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%86%85%E7%BD%AE%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.</span> <span class="nav-text">一、内置运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.1.</span> <span class="nav-text">1.1 算数运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.2.</span> <span class="nav-text">1.2 关系运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.3.</span> <span class="nav-text">1.3 逻辑运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.4.</span> <span class="nav-text">1.4 赋值运算符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%9D%A1%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">二、条件循环</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-if-else-%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 if else(分支结构)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-for-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 for(循环结构)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-switch-case"><span class="nav-number">3.3.</span> <span class="nav-text">2.3 switch case</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-break%E3%80%81continue"><span class="nav-number">3.4.</span> <span class="nav-text">2.4 break、continue</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%87%BD%E6%95%B0"><span class="nav-number">4.</span> <span class="nav-text">三、函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E5%87%BD%E6%95%B0%E5%9F%BA%E7%A1%80"><span class="nav-number">4.1.</span> <span class="nav-text">3.1 函数基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%87%BD%E6%95%B0%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">4.2.</span> <span class="nav-text">3.2 函数变量作用域</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">5.</span> <span class="nav-text">四、结构体</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">5.1.</span> <span class="nav-text">1.1 什么是结构体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9A%E4%B9%89"><span class="nav-number">5.2.</span> <span class="nav-text">1.2 结构体定义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%88%E6%B3%951%EF%BC%89"><span class="nav-number">5.2.1.</span> <span class="nav-text">1、基本实例化（法1）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81new%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%88%E6%B3%952%EF%BC%89"><span class="nav-number">5.2.2.</span> <span class="nav-text">2、new实例化（法2）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E9%94%AE%E5%80%BC%E5%AF%B9%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88%E6%B3%953%EF%BC%89"><span class="nav-number">5.2.3.</span> <span class="nav-text">3、键值对初始化（法3）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E7%BB%93%E6%9E%84%E4%BD%93%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E6%94%B6%E8%80%85"><span class="nav-number">5.3.</span> <span class="nav-text">1.3 结构体方法和接收者</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E7%BB%93%E6%9E%84%E4%BD%93%E8%AF%B4%E6%98%8E"><span class="nav-number">5.3.1.</span> <span class="nav-text">1、结构体说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E7%BB%93%E6%9E%84%E4%BD%93%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E6%94%B6%E8%80%85"><span class="nav-number">5.3.2.</span> <span class="nav-text">2、结构体方法和接收者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E6%8E%A5%E6%94%B6%E8%80%85"><span class="nav-number">5.3.3.</span> <span class="nav-text">3、值类型和指针类型接收者</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4%E3%80%81%E4%B8%80%E4%B8%AA%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9E%E7%8E%B0%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.4.</span> <span class="nav-text">1.4、一个结构体实现多个接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5%E3%80%81%E6%8E%A5%E5%8F%A3%E5%B5%8C%E5%A5%97-%E7%BB%A7%E6%89%BF"><span class="nav-number">5.5.</span> <span class="nav-text">1.5、接口嵌套(继承)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.</span> <span class="nav-text">五、面向对象</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Golang%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">6.1.</span> <span class="nav-text">5.1 Golang接口的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E7%A9%BA%E6%8E%A5%E5%8F%A3"><span class="nav-number">6.2.</span> <span class="nav-text">5.2 空接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="nav-number">6.3.</span> <span class="nav-text">5.3 类型断言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E5%80%BC%E6%8E%A5%E6%94%B6%E8%80%85%E5%92%8C%E6%8C%87%E9%92%88%E6%8E%A5%E6%94%B6%E8%80%85"><span class="nav-number">6.4.</span> <span class="nav-text">5.4 值接收者和指针接收者</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="nav-number">7.</span> <span class="nav-text">六、并发编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E5%B9%B6%E5%8F%91%E4%BB%8B%E7%BB%8D"><span class="nav-number">7.1.</span> <span class="nav-text">6.1 并发介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-goroutine"><span class="nav-number">7.2.</span> <span class="nav-text">6.2 goroutine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E5%8D%8F%E7%A8%8B%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">7.3.</span> <span class="nav-text">6.3 协程基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-Channel"><span class="nav-number">7.4.</span> <span class="nav-text">6.4.Channel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Channel-%E7%AE%A1%E9%81%93"><span class="nav-number">7.4.1.</span> <span class="nav-text">1.Channel 管道</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-Channel%E8%AF%B4%E6%98%8E"><span class="nav-number">7.4.1.1.</span> <span class="nav-text">1.1 Channel说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-channel%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.4.1.2.</span> <span class="nav-text">1.2 channel类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-%E5%88%9B%E5%BB%BAchannel"><span class="nav-number">7.4.1.3.</span> <span class="nav-text">1.3 创建channel</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-channel%E6%93%8D%E4%BD%9C"><span class="nav-number">7.4.2.</span> <span class="nav-text">2.channel操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E5%8F%91%E9%80%81%EF%BC%88%E5%B0%86%E6%95%B0%E6%8D%AE%E6%94%BE%E5%9C%A8%E7%AE%A1%E9%81%93%E5%86%85%EF%BC%89"><span class="nav-number">7.4.2.1.</span> <span class="nav-text">2.1 发送（将数据放在管道内）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E6%8E%A5%E6%94%B6%EF%BC%88%E4%BB%8E%E7%AE%A1%E9%81%93%E5%86%85%E5%8F%96%E5%80%BC%EF%BC%89"><span class="nav-number">7.4.2.2.</span> <span class="nav-text">2.2 接收（从管道内取值）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E5%85%B3%E9%97%AD%E7%AE%A1%E9%81%93"><span class="nav-number">7.4.2.3.</span> <span class="nav-text">2.3 关闭管道</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-%E7%AE%A1%E9%81%93%E9%98%BB%E5%A1%9E"><span class="nav-number">7.4.2.4.</span> <span class="nav-text">2.4 管道阻塞</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-1-%E6%97%A0%E7%BC%93%E5%86%B2%E7%9A%84%E7%AE%A1%E9%81%93"><span class="nav-number">7.4.2.4.1.</span> <span class="nav-text">2.4.1 无缓冲的管道</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-2-%E6%9C%89%E7%BC%93%E5%86%B2%E7%9A%84%E7%AE%A1%E9%81%93"><span class="nav-number">7.4.2.4.2.</span> <span class="nav-text">2.4.2 有缓冲的管道</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BB%8Echannel%E5%8F%96%E5%80%BC"><span class="nav-number">7.4.3.</span> <span class="nav-text">3.从channel取值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E4%BC%98%E9%9B%85%E7%9A%84%E4%BB%8Echannel%E5%8F%96%E5%80%BC"><span class="nav-number">7.4.3.1.</span> <span class="nav-text">3.1 优雅的从channel取值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-Goroutine%E7%BB%93%E5%90%88Channel%E7%AE%A1%E9%81%93"><span class="nav-number">7.4.3.2.</span> <span class="nav-text">3.2 Goroutine结合Channel管道</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8D%95%E5%90%91%E7%AE%A1%E9%81%93"><span class="nav-number">7.4.4.</span> <span class="nav-text">4.单向管道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Goroutine%E6%B1%A0"><span class="nav-number">7.4.5.</span> <span class="nav-text">5.Goroutine池</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-select"><span class="nav-number">7.5.</span> <span class="nav-text">6.5.select</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-select%E8%AF%B4%E6%98%8E"><span class="nav-number">7.5.1.</span> <span class="nav-text">6.1 select说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-select-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">7.5.2.</span> <span class="nav-text">6.2 select 的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-6-%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E5%92%8C%E9%94%81"><span class="nav-number">7.6.</span> <span class="nav-text">6.6.并发安全和锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E4%B8%8E%E9%94%81"><span class="nav-number">7.6.1.</span> <span class="nav-text">1.并发安全与锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8"><span class="nav-number">7.6.1.1.</span> <span class="nav-text">1.1 并发安全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E4%BA%92%E6%96%A5%E9%94%81"><span class="nav-number">7.6.1.2.</span> <span class="nav-text">1.2 互斥锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-%E8%AF%BB%E5%86%99%E4%BA%92%E6%96%A5%E9%94%81"><span class="nav-number">7.6.1.3.</span> <span class="nav-text">1.3 读写互斥锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-sync%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="nav-number">7.6.2.</span> <span class="nav-text">2.sync其他方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-sync-WaitGroup"><span class="nav-number">7.6.2.1.</span> <span class="nav-text">2.1 sync.WaitGroup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2sync-Once"><span class="nav-number">7.6.2.2.</span> <span class="nav-text">2.2sync.Once</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-sync-Map"><span class="nav-number">7.6.2.3.</span> <span class="nav-text">2.3 sync.Map</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-7-goroutine%E5%8E%9F%E7%90%86"><span class="nav-number">7.7.</span> <span class="nav-text">6.7.goroutine原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="nav-number">7.7.1.</span> <span class="nav-text">1.设计思路</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E8%AE%BE%E8%AE%A1%E6%8F%8F%E8%BF%B0"><span class="nav-number">7.7.1.1.</span> <span class="nav-text">1.1 设计描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-Pool-struct"><span class="nav-number">7.7.1.2.</span> <span class="nav-text">1.2 Pool struct</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-%E5%88%9D%E5%A7%8B%E5%8C%96-Pool-%E5%B9%B6%E5%90%AF%E5%8A%A8%E5%AE%9A%E6%9C%9F%E6%B8%85%E7%90%86%E8%BF%87%E6%9C%9F-worker-%E4%BB%BB%E5%8A%A1"><span class="nav-number">7.7.1.3.</span> <span class="nav-text">1.3 初始化 Pool 并启动定期清理过期 worker 任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-%E6%8F%90%E4%BA%A4%E4%BB%BB%E5%8A%A1%E5%88%B0-Pool"><span class="nav-number">7.7.1.4.</span> <span class="nav-text">1.4 提交任务到 Pool</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-%E8%8E%B7%E5%8F%96%E5%8F%AF%E7%94%A8-worker-%E6%A0%B8%E5%BF%83"><span class="nav-number">7.7.1.5.</span> <span class="nav-text">1.5 获取可用 worker(核心)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1"><span class="nav-number">7.7.1.6.</span> <span class="nav-text">1.6 执行任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7-worker%E5%9B%9E%E6%94%B6-goroutine-%E5%A4%8D%E7%94%A8"><span class="nav-number">7.7.1.7.</span> <span class="nav-text">1.7 worker回收(goroutine 复用)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-%E5%8A%A8%E6%80%81%E6%89%A9%E5%AE%B9%E6%88%96%E8%80%85%E7%BC%A9%E5%B0%8F%E6%B1%A0%E5%AE%B9%E9%87%8F"><span class="nav-number">7.7.1.8.</span> <span class="nav-text">1.8 动态扩容或者缩小池容量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-9-%E5%AE%9A%E6%9C%9F%E6%B8%85%E7%90%86%E8%BF%87%E6%9C%9F-Worker"><span class="nav-number">7.7.1.9.</span> <span class="nav-text">1.9 定期清理过期 Worker</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-pool%E4%BD%BF%E7%94%A8"><span class="nav-number">7.7.2.</span> <span class="nav-text">2.pool使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E5%85%AC%E5%85%B1%E6%B1%A0"><span class="nav-number">7.7.2.1.</span> <span class="nav-text">2.1 公共池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E6%96%B9%E6%B3%95%E7%BB%91%E5%AE%9A%E6%B1%A0"><span class="nav-number">7.7.2.2.</span> <span class="nav-text">2.2 方法绑定池</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">8.</span> <span class="nav-text">七、常用模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81fmt"><span class="nav-number">8.1.</span> <span class="nav-text">一、fmt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%B8%B8%E7%94%A8%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="nav-number">8.1.1.</span> <span class="nav-text">1.1 常用占位符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Print"><span class="nav-number">8.1.2.</span> <span class="nav-text">1.2 Print</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Sprint"><span class="nav-number">8.1.3.</span> <span class="nav-text">1.3 Sprint</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81time"><span class="nav-number">8.2.</span> <span class="nav-text">二、time</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="nav-number">8.2.1.</span> <span class="nav-text">2.1 时间类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-number">8.2.2.</span> <span class="nav-text">2.2 时间戳</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="nav-number">8.2.3.</span> <span class="nav-text">2.3 时间间隔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="nav-number">8.2.4.</span> <span class="nav-text">2.4 时间格式化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%97%B6%E9%97%B4%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">8.2.5.</span> <span class="nav-text">2.5 时间操作函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81encoding-json%E5%8C%85"><span class="nav-number">8.3.</span> <span class="nav-text">三、encoding-json包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-struct%E4%B8%8Ejson"><span class="nav-number">8.3.1.</span> <span class="nav-text">3.1 struct与json</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81struct%E8%BD%ACJson%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">8.3.1.1.</span> <span class="nav-text">1、struct转Json字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81Json%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%ACstruct"><span class="nav-number">8.3.1.2.</span> <span class="nav-text">2、Json字符串转struct</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-struct-tag"><span class="nav-number">8.3.2.</span> <span class="nav-text">3.2 struct tag</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81Tag%E6%A0%87%E7%AD%BE%E8%AF%B4%E6%98%8E"><span class="nav-number">8.3.2.1.</span> <span class="nav-text">1、Tag标签说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81Tag%E7%BB%93%E6%9E%84%E4%BD%93%E8%BD%AC%E5%8C%96Json%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">8.3.2.2.</span> <span class="nav-text">2、Tag结构体转化Json字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81Json%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%88%90Tag%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">8.3.2.3.</span> <span class="nav-text">3、Json字符串转成Tag结构体</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Flag"><span class="nav-number">8.4.</span> <span class="nav-text">四、Flag</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Flag"><span class="nav-number">8.4.1.</span> <span class="nav-text">4.1 Flag</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#flag-Parse"><span class="nav-number">8.4.1.1.</span> <span class="nav-text">flag.Parse()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="nav-number">8.4.1.2.</span> <span class="nav-text">2、其他函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B"><span class="nav-number">8.4.2.</span> <span class="nav-text">4.2 完整示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81main-go"><span class="nav-number">8.4.2.1.</span> <span class="nav-text">1、main.go</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E6%9F%A5%E7%9C%8B%E5%B8%AE%E5%8A%A9"><span class="nav-number">8.4.2.2.</span> <span class="nav-text">2、查看帮助</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81flag%E5%8F%82%E6%95%B0%E6%BC%94%E7%A4%BA"><span class="nav-number">8.4.2.3.</span> <span class="nav-text">3、flag参数演示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E9%9D%9Eflag%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-number">8.4.2.4.</span> <span class="nav-text">4、非flag命令行参数</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">tigerfive</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tigerfive</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
