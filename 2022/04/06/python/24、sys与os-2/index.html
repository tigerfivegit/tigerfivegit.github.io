<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tigerfivegit.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="os模块操作系统数据1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991">
<meta property="og:type" content="article">
<meta property="og:title" content="24、sys与os-2.md">
<meta property="og:url" content="https://tigerfivegit.github.io/2022/04/06/python/24%E3%80%81sys%E4%B8%8Eos-2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="os模块操作系统数据1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-04-05T18:36:32.633Z">
<meta property="article:modified_time" content="2022-04-05T18:36:32.633Z">
<meta property="article:author" content="tigerfive">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tigerfivegit.github.io/2022/04/06/python/24%E3%80%81sys%E4%B8%8Eos-2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>24、sys与os-2.md | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tigerfivegit.github.io/2022/04/06/python/24%E3%80%81sys%E4%B8%8Eos-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tigerfive">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          24、sys与os-2.md
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-06 02:36:32" itemprop="dateCreated datePublished" datetime="2022-04-06T02:36:32+08:00">2022-04-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="os模块操作系统数据"><a href="#os模块操作系统数据" class="headerlink" title="os模块操作系统数据"></a>os模块操作系统数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line">获取工作路径：</span><br><span class="line">    os.getcwd()</span><br><span class="line"></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">创建目录：</span><br><span class="line">    语法：    </span><br><span class="line">        os.mkdir(path[, mode])</span><br><span class="line">        注意：可选项mode为权限设置，默认权限为0755，但是g和o位置的写权限是设置不上的</span><br><span class="line">            </span><br><span class="line">    os.mkdir(&quot;/python/test&quot;,0755)</span><br><span class="line">  </span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">  </span><br><span class="line">创建空文件：</span><br><span class="line">    os.mknod(&quot;/tmp/test.txt&quot;,0666)</span><br><span class="line">    注意：同样权限为可选项，而且也不能设置g和o位置的写权限</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">创建连级目录：</span><br><span class="line">    os.makedirs(&#x27;/tmp/bb/cc/dd/ee&#x27;,0111)</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">列出指定目录下文件：</span><br><span class="line">    os.listdir(&quot;/python&quot;)</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">查看文件状态：</span><br><span class="line">    os.stat(&quot;/python&quot;)</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">重命名文件：</span><br><span class="line">    os.rename(&quot;/python/test1&quot;,&quot;/python/test5&quot;)</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">删除空目录</span><br><span class="line">    os.rmdir(&quot;/python/test&quot;) </span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">删除非空目录：</span><br><span class="line">    需要导入shutil模块    </span><br><span class="line">    shutil.rmtree(&quot;/tmp/aa&quot;)     </span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">切换路径 ：</span><br><span class="line">    os.chdir(&quot;/&quot;)    </span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">判断文件或目录是否存在： </span><br><span class="line">    os.path.exist()        </span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">判断文件权限：</span><br><span class="line">概述:</span><br><span class="line">os.access() 方法使用当前的uid/gid（只对当前用户的权限生效）尝试访问路径。大部分操作</span><br><span class="line">使用有效的 uid/gid, 因此运行环境可以在 suid/sgid 环境尝试。</span><br><span class="line"></span><br><span class="line">语法:</span><br><span class="line">    os.access(path, mode);</span><br><span class="line"></span><br><span class="line">参数:</span><br><span class="line">    path -- 要用来检测是否有访问权限的路径。</span><br><span class="line">    mode -- mode为F_OK，测试存在的路径，或者它可以是包含R_OK, W_OK和X_OK或者R_OK, W_OK和X_OK其中之一</span><br><span class="line"></span><br><span class="line">    os.F_OK: 作为access()的mode参数，测试path是否存在。</span><br><span class="line">    os.R_OK: 包含在access()的mode参数中 ， 测试path是否可读。</span><br><span class="line">    os.W_OK: 包含在access()的mode参数中 ， 测试path是否可写。</span><br><span class="line">    os.X_OK: 包含在access()的mode参数中 ，测试path是否可执行。</span><br><span class="line"></span><br><span class="line">返回值:</span><br><span class="line">    如果允许访问返回 True , 否则返回False。</span><br><span class="line"></span><br><span class="line">实例:</span><br><span class="line">    #!/usr/bin/python</span><br><span class="line">    # -*- coding: UTF-8 -*-</span><br><span class="line">    import os, sys</span><br><span class="line">    # 假定 /tmp/foo.txt 文件存在，并有读写权限</span><br><span class="line">    ret = os.access(&quot;/tmp/foo.txt&quot;, os.F_OK)</span><br><span class="line">    print &quot;F_OK - 返回值 %s&quot;% ret</span><br><span class="line"></span><br><span class="line">    ret = os.access(&quot;/tmp/foo.txt&quot;, os.R_OK)</span><br><span class="line">    print &quot;R_OK - 返回值 %s&quot;% ret</span><br><span class="line"></span><br><span class="line">    ret = os.access(&quot;/tmp/foo.txt&quot;, os.W_OK)</span><br><span class="line">    print &quot;W_OK - 返回值 %s&quot;% ret</span><br><span class="line"></span><br><span class="line">    ret = os.access(&quot;/tmp/foo.txt&quot;, os.X_OK)</span><br><span class="line">    print &quot;X_OK - 返回值 %s&quot;% ret</span><br><span class="line"></span><br><span class="line">执行以上程序输出结果为：</span><br><span class="line">    F_OK - 返回值 True</span><br><span class="line">    R_OK - 返回值 True</span><br><span class="line">    W_OK - 返回值 True</span><br><span class="line">    X_OK - 返回值 False</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">更改文件或目录的权限:</span><br><span class="line">语法</span><br><span class="line">    os.chmod(path, mode)</span><br><span class="line"></span><br><span class="line">参数</span><br><span class="line">path -- 文件名路径或目录路径。</span><br><span class="line">flags -- 可用以下选项按位或操作生成， 目录的读权限表示可以获取目录里文件名列表， ，执行权限表示可</span><br><span class="line">以把工作目录切换到此目录 ，删除添加目录里的文件必须同时有写和执行权限 ，文件权限以用户id-&gt;组id-</span><br><span class="line">&gt;其它顺序检验,最先匹配的允许或禁止权限被应用。</span><br><span class="line">    stat.S_IXOTH: 其他用户有执行权0o001</span><br><span class="line">    stat.S_IWOTH: 其他用户有写权限0o002</span><br><span class="line">    stat.S_IROTH: 其他用户有读权限0o004</span><br><span class="line">    stat.S_IRWXO: 其他用户有全部权限(权限掩码)0o007</span><br><span class="line">    stat.S_IXGRP: 组用户有执行权限0o010</span><br><span class="line">    stat.S_IWGRP: 组用户有写权限0o020</span><br><span class="line">    stat.S_IRGRP: 组用户有读权限0o040</span><br><span class="line">    stat.S_IRWXG: 组用户有全部权限(权限掩码)0o070</span><br><span class="line">    stat.S_IXUSR: 拥有者具有执行权限0o100</span><br><span class="line">    stat.S_IWUSR: 拥有者具有写权限0o200</span><br><span class="line">    stat.S_IRUSR: 拥有者具有读权限0o400</span><br><span class="line">    stat.S_IRWXU: 拥有者有全部权限(权限掩码)0o700</span><br><span class="line">    stat.S_ISVTX: 目录里文件目录只有拥有者才可删除更改0o1000</span><br><span class="line">    stat.S_ISGID: 执行此文件其进程有效组为文件所在组0o2000</span><br><span class="line">    stat.S_ISUID: 执行此文件其进程有效用户为文件所有者0o4000</span><br><span class="line">    stat.S_IREAD: windows下设为只读</span><br><span class="line">    stat.S_IWRITE: windows下取消只读</span><br><span class="line"></span><br><span class="line">返回值</span><br><span class="line">该方法没有返回值。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line">以下实例演示了 chmod() 方法的使用：</span><br><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line">import os, sys, stat</span><br><span class="line"># 假定 /tmp/foo.txt 文件存在，设置文件可以通过用户组执行</span><br><span class="line"></span><br><span class="line">os.chmod(&quot;/tmp/foo.txt&quot;, stat.S_IXGRP)</span><br><span class="line"></span><br><span class="line"># 设置文件可以被其他用户写入</span><br><span class="line">os.chmod(&quot;/tmp/foo.txt&quot;, stat.S_IWOTH)</span><br><span class="line"></span><br><span class="line">print &quot;修改成功!!&quot;</span><br><span class="line">执行以上程序输出结果为：</span><br><span class="line">修改成功!!</span><br><span class="line"></span><br><span class="line">注意：不一定用stat模块的权限状态，可以直接使用数字权限,os.chmod(&#x27;a.txt&#x27;,0777)</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">创建硬链接</span><br><span class="line">该方法对于创建一个已存在文件的拷贝是非常有用的。</span><br><span class="line"></span><br><span class="line">语法:</span><br><span class="line">    os.link(src, dst)</span><br><span class="line"></span><br><span class="line">参数</span><br><span class="line">    src -- 用于创建硬连接的源地址</span><br><span class="line">    dst -- 用于创建硬连接的目标地址</span><br><span class="line"></span><br><span class="line">返回值</span><br><span class="line">    该方法没有返回值。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line">    #!/usr/bin/python</span><br><span class="line">    # -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">    import os, sys</span><br><span class="line"></span><br><span class="line">    # 打开文件</span><br><span class="line">    path = &quot;/var/www/html/foo.txt&quot;</span><br><span class="line">    fd = os.open( path, os.O_RDWR|os.O_CREAT )</span><br><span class="line"></span><br><span class="line">    # 关闭文件</span><br><span class="line">    os.close( fd )</span><br><span class="line"></span><br><span class="line">    # 创建以上文件的拷贝</span><br><span class="line">    dst = &quot;/tmp/foo.txt&quot;</span><br><span class="line">    os.link( path, dst)</span><br><span class="line"></span><br><span class="line">    print &quot;创建硬链接成功!!&quot;</span><br><span class="line">    执行以上程序输出结果为：</span><br><span class="line">    创建硬链接成功!!</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">打开一个文件：</span><br><span class="line">打开一个文件，并且设置需要的打开选项，模式参数mode参数是可选的，默认为 0777。</span><br><span class="line"></span><br><span class="line">语法</span><br><span class="line">    open()方法语法格式如下：</span><br><span class="line">    os.open(file, flags[, mode]);</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line">    file -- 要打开的文件</span><br><span class="line">    flags -- 该参数可以是以下选项，多个使用 &quot;|&quot; 隔开：</span><br><span class="line"></span><br><span class="line">    os.O_RDONLY: 以只读的方式打开</span><br><span class="line">    os.O_WRONLY: 以只写的方式打开</span><br><span class="line">    os.O_RDWR : 以读写的方式打开</span><br><span class="line">    os.O_NONBLOCK: 打开时不阻塞</span><br><span class="line">    os.O_APPEND: 以追加的方式打开</span><br><span class="line">    os.O_CREAT: 创建并打开一个新文件</span><br><span class="line">    os.O_TRUNC: 打开一个文件并截断它的长度为零（必须有写权限）</span><br><span class="line">    os.O_EXCL: 如果指定的文件存在，返回错误</span><br><span class="line">    os.O_SHLOCK: 自动获取共享锁</span><br><span class="line">    os.O_EXLOCK: 自动获取独立锁</span><br><span class="line">    os.O_DIRECT: 消除或减少缓存效果</span><br><span class="line">    os.O_FSYNC : 同步写入</span><br><span class="line">    os.O_NOFOLLOW: 不追踪软链接</span><br><span class="line">    mode -- 类似 chmod()。</span><br><span class="line"></span><br><span class="line">返回值：</span><br><span class="line">    返回新打开文件的描述符。</span><br><span class="line"></span><br><span class="line">实例：</span><br><span class="line">    #!/usr/bin/python</span><br><span class="line">    # -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">    import os, sys</span><br><span class="line"></span><br><span class="line">    # 打开文件</span><br><span class="line">    fd = os.open( &quot;foo.txt&quot;, os.O_RDWR|os.O_CREAT )</span><br><span class="line"></span><br><span class="line">    # 写入字符串</span><br><span class="line">    os.write(fd, &quot;This is test&quot;)</span><br><span class="line"></span><br><span class="line">    # 关闭文件</span><br><span class="line">    os.close( fd )</span><br><span class="line"></span><br><span class="line">    print &quot;关闭文件成功!!&quot;</span><br><span class="line">    执行以上程序输出结果为：</span><br><span class="line">    关闭文件成功!!</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">#coding=utf-8</span><br><span class="line">import os</span><br><span class="line">dir = &quot;/python/test2&quot;</span><br><span class="line">print os.getcwd() #获取工作路径</span><br><span class="line"></span><br><span class="line">os.mkdir(&quot;/python/test1&quot;) #创建目录</span><br><span class="line">os.mkdir(dir)</span><br><span class="line">os.mknod(&quot;/tmp/a.txt&quot;)  #创建空文件</span><br><span class="line">os.makedirs(&quot;/python/test11/a/b/c&quot;)  #创建连级目录</span><br><span class="line"></span><br><span class="line">print os.listdir(&quot;/python&quot;) #列出指定目录下文件</span><br><span class="line"></span><br><span class="line">print os.stat(&quot;/python&quot;) #类似于系统命令stat</span><br><span class="line"></span><br><span class="line">os.rename(&quot;/python/test1&quot;,&quot;/python/test5&quot;) #重命名文件</span><br><span class="line"></span><br><span class="line">os.rmdir(&quot;/python/test&quot;) #删除目录</span><br><span class="line"></span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">import os</span><br><span class="line">os.chdir(&quot;/&quot;)            #切换路径</span><br><span class="line">pwd = os.getcwd()</span><br><span class="line">print os.listdir(pwd)</span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="path方法"><a href="#path方法" class="headerlink" title="path方法"></a>path方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">os.path.exist() #判断文件或目录是否存在</span><br><span class="line"></span><br><span class="line">os.path.按tab键 查看os.path内所有方法，大多都很有用</span><br><span class="line"></span><br><span class="line">os.path模块常用函数简介</span><br><span class="line">basename()   #去掉目录路径，返回文件名</span><br><span class="line"> &gt;&gt;&gt;os.path.basename(&quot;/root/python/zip.py&quot;)</span><br><span class="line">&#x27;zip.py&#x27;</span><br><span class="line"></span><br><span class="line">dirname()    #去掉文件名，返回目录路径</span><br><span class="line">&gt;&gt;&gt; os.path.dirname(&quot;/root/python/zip.py&quot;) </span><br><span class="line">&#x27;/root/python&#x27;</span><br><span class="line"></span><br><span class="line">join()           #将分离的各部分组合成一个路径名</span><br><span class="line">&gt;&gt;&gt; os.path.join(&quot;/root/python/&quot;,&quot;zip.py&quot;)      </span><br><span class="line">&#x27;/root/python/zip.py&#x27;</span><br><span class="line"></span><br><span class="line">split()         #返回目录路径和文件名的元组</span><br><span class="line">&gt;&gt;&gt; os.path.split(&quot;/root/python/zip.py&quot;)        </span><br><span class="line">(&#x27;/root/python&#x27;, &#x27;zip.py&#x27;)</span><br><span class="line"></span><br><span class="line">splitdrive() #返回驱动符号和路径字符元组</span><br><span class="line">&gt;&gt;&gt; os.path.splitdrive(&quot;/root/python/zip.py&quot;)</span><br><span class="line">(&#x27;&#x27;, &#x27;/root/python/zip.py&#x27;)</span><br><span class="line"></span><br><span class="line">splitext()   #返回文件名和扩展名元组</span><br><span class="line">&gt;&gt;&gt;os.path.splitext(&quot;zip.py&quot;)</span><br><span class="line">(&#x27;zip&#x27;,&#x27;.py&#x27;)</span><br><span class="line"></span><br><span class="line">getatime()   #返回文件最近的访问时间</span><br><span class="line">&gt;&gt;&gt; os.path.getatime(&quot;/root/python/zip.py&quot;)</span><br><span class="line">1297653596</span><br><span class="line">&gt;&gt;&gt; time.ctime(1297653596)</span><br><span class="line">&#x27;Mon Feb 14 11:19:56 2011&#x27;</span><br><span class="line"></span><br><span class="line">getctime()   #返回文件的创建时间</span><br><span class="line"></span><br><span class="line">getmtime() #返回文件的修改时间</span><br><span class="line"></span><br><span class="line">getsize()     #返回文件的大小单位为字节</span><br><span class="line">&gt;&gt;&gt; os.path.getsize(&quot;zip.py&quot;)</span><br><span class="line">864</span><br><span class="line"></span><br><span class="line">exists()    #指定路径（文件或目录）是否存在</span><br><span class="line">&gt;&gt;&gt; os.path.exists(&quot;/root/python/xukai.py&quot;)</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; os.path.exists(&quot;/root/python/zip.py&quot;)  </span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">isabs()     #指定路径是否为绝对路径</span><br><span class="line">&gt;&gt;&gt; os.path.isabs(&quot;/root/python/zip.py&quot;) </span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; os.path.isabs(&quot;root/python/zip.py&quot;) </span><br><span class="line">False</span><br><span class="line"></span><br><span class="line">isdir()     #指定路径是否存在且为一个目录</span><br><span class="line"></span><br><span class="line">isfile()    #指定的路径是否为一个文件</span><br><span class="line"></span><br><span class="line">samefile()  #两个路径名是否指向同一个文件</span><br></pre></td></tr></table></figure>

<h3 id="跨平台"><a href="#跨平台" class="headerlink" title="跨平台"></a>跨平台</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">路径分隔符(POSIX 使用 &quot;/&quot;, DOS 和 Windows 使用 &quot;\&quot;, 旧版本的 MacOS 使用&quot;:&quot;), 它用来</span><br><span class="line">分隔文件路径名, 标记当前目录和父目录.</span><br><span class="line">当我们创建要跨这三个平台的应用的时候, 这些差异会让我们感觉非常麻烦(而且支持的平台越多越麻烦)</span><br><span class="line">Python 的 os 模块设计者已经帮我们想到了这些问题. </span><br><span class="line">os 模块有五个很有用的属性：</span><br><span class="line">    linesep  用于在文件中分隔行的字符串</span><br><span class="line">    sep       用来分隔文件路径名的字符串</span><br><span class="line">    pathsep用于分隔文件路径的字符串</span><br><span class="line">    curdir    当前工作目录的字符串名称</span><br><span class="line">    pardir    (当前工作目录的)父目录字符串名称</span><br><span class="line">不管你使用的是什么平台, 只要你导入了 os 模块, 这些变量自动会被设置为正确的值, 减少了你的麻烦</span><br><span class="line"></span><br><span class="line">下例中我们每次从用户接收一行输入, 然后将文本保存到文件中. 由于 raw_input()不会保留用户输入的换行符 , 调用write()方法时必须加上 换行符。而且 ,在键盘上很难输入一个EOF(end-of-file)字符,所以,程序使用句号( . )作为文件结束的标志, 当用户输入句号后会自动结束输入并关闭文件.</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">filename = raw_input(&#x27;Enter file name: &#x27;)</span><br><span class="line">fobj = open(filename, &#x27;w&#x27;)</span><br><span class="line">while True:</span><br><span class="line">    aLine = raw_input(&quot;Enter a line (&#x27;.&#x27; to quit): &quot;)</span><br><span class="line">    if aLine != &quot;.&quot;:</span><br><span class="line">        fobj.write(&#x27;%s%s&#x27; % (aLine, os.linesep)              #这里的linesep不管是windows还是linux都可以表示他们的换行符</span><br><span class="line">    else:</span><br><span class="line">        break</span><br><span class="line">fobj.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="statsvfs"><a href="#statsvfs" class="headerlink" title="statsvfs"></a>statsvfs</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">python获得磁盘剩余空间statvfs：</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; import statvfs</span><br><span class="line">&gt;&gt;&gt; vfs=os.statvfs(&quot;/home&quot;)</span><br><span class="line">&gt;&gt;&gt; vfs</span><br><span class="line">(4096, 4096, 70959944, 70058799, 66396080, 73269248, 73234981, 73234981, 0, 255)</span><br><span class="line">&gt;&gt;&gt; dir(statvfs)</span><br><span class="line">[&#x27;F_BAVAIL&#x27;, &#x27;F_BFREE&#x27;, &#x27;F_BLOCKS&#x27;, &#x27;F_BSIZE&#x27;, &#x27;F_FAVAIL&#x27;, &#x27;F_FFREE&#x27;, &#x27;F_FILES&#x27;, &#x27;F_FLAG</span><br><span class="line"></span><br><span class="line">struct statfs &#123; </span><br><span class="line">  long    f_type;     /* 文件系统类型  */ </span><br><span class="line">  long    f_bsize;    /* 经过优化的传输块大小  */ </span><br><span class="line">  long    f_blocks;   /* 文件系统数据块总数 */ </span><br><span class="line">  long    f_bfree;    /* 可用块数 */ </span><br><span class="line">  long    f_bavail;   /* 非超级用户可获取的块数 */ </span><br><span class="line">  long    f_files;    /* 文件结点总数 */ </span><br><span class="line">  long    f_ffree;    /* 可用文件结点数 */ </span><br><span class="line">  fsid_t  f_fsid;     /* 文件系统标识 */ </span><br><span class="line">  long    f_namelen;  /* 文件名的最大长度 */ </span><br><span class="line">&#125;; </span><br><span class="line">statfs结构中可用空间块数有两种f_bfree和 f_bavail，前者是硬盘所有剩余空间，后者为非root用</span><br><span class="line">户剩余空间，ext3文件系统给root用户分有5%的独享空间，所以这里是不同的地方。这里要强调的</span><br><span class="line">是每块的大小一般是4K。因此，要实现与df结果一致的就得在获得块数上乘以4，这样已用、可用、</span><br><span class="line">总块数就可以实现。如果还要实现百分比一致，那么要注意的是，df命令获得是整数百分比，没有小</span><br><span class="line">数，这里使用的进一法，而不是四舍五入法。所以在程序里直接+1取整。</span><br><span class="line"></span><br><span class="line">def disk_stat():</span><br><span class="line">        import os</span><br><span class="line">        disk = os.statvfs(&#x27;/usr&#x27;)</span><br><span class="line">        percent = (disk.f_blocks - disk.f_bfree) * 100 / (disk.f_blocks -disk.f_bfree + disk.f_bavail) + 1</span><br><span class="line">        return percent</span><br><span class="line">print disk_stat()</span><br><span class="line"></span><br><span class="line">获得df多个磁盘空间及内存：</span><br><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from __future__ import division</span><br><span class="line">import os</span><br><span class="line">file = open(&#x27;/soft/disk&#x27;,&#x27;a&#x27;)</span><br><span class="line"> </span><br><span class="line">def disk_root():</span><br><span class="line">        disk = os.statvfs(&#x27;/&#x27;)</span><br><span class="line">        percent = (disk.f_blocks - disk.f_bfree) * 100 / (disk.f_blocks -disk.f_bfree + disk.f_bavail)</span><br><span class="line">        return percent</span><br><span class="line"> </span><br><span class="line">def disk_backup():</span><br><span class="line">        disk = os.statvfs(&#x27;/backup&#x27;)</span><br><span class="line">        percent = (disk.f_blocks - disk.f_bfree) * 100 / (disk.f_blocks -disk.f_bfree + disk.f_bavail)</span><br><span class="line">        return percent</span><br><span class="line"> </span><br><span class="line">def disk_project():</span><br><span class="line">        disk = os.statvfs(&#x27;/project&#x27;)</span><br><span class="line">        percent = (disk.f_blocks - disk.f_bfree) * 100 / (disk.f_blocks -disk.f_bfree + disk.f_bavail)</span><br><span class="line">        return percent</span><br><span class="line"> </span><br><span class="line">def mem_stat():</span><br><span class="line">        mem = &#123;&#125;</span><br><span class="line">        f = open(&#x27;/proc/meminfo&#x27;)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        f.close()</span><br><span class="line">        for line in lines:</span><br><span class="line">                name = line.split(&#x27;:&#x27;)[0]</span><br><span class="line">                var = line.split(&#x27;:&#x27;)[1].split()[0]</span><br><span class="line">                mem[name] = long(var)</span><br><span class="line">        Mem = (100 - ((mem[&#x27;MemFree&#x27;] + mem[&#x27;Buffers&#x27;] + mem[&#x27;Cached&#x27;]) / mem[&#x27;MemTotal&#x27;]) * 100)</span><br><span class="line">        return Mem</span><br><span class="line"> </span><br><span class="line">root = &#x27;/                   %0.f%%&#x27;%disk_root()+&#x27;\n&#x27;</span><br><span class="line">backup = &#x27;/backup             %0.f%%&#x27;%disk_backup()+&#x27;\n&#x27;</span><br><span class="line">project = &#x27;/project            %0.f%%&#x27;%disk_project()+&#x27;\n&#x27;</span><br><span class="line">memory = &#x27;memory           %0.2f%%&#x27;%mem_stat()+&#x27;\n&#x27;</span><br><span class="line"> </span><br><span class="line">file.writelines(&#x27;Filesystem&amp;Mem     Use%&#x27;+&#x27;\n&#x27;+&#x27;-----------------------&#x27;+&#x27;\n&#x27;)</span><br><span class="line">file.writelines(root)</span><br><span class="line">file.writelines(backup)</span><br><span class="line">file.writelines(project)</span><br><span class="line">file.writelines(memory)</span><br><span class="line">file.flush()</span><br><span class="line">file.close()</span><br><span class="line"></span><br><span class="line">打印结果：</span><br><span class="line">cat disk</span><br><span class="line">Filesystem&amp;Mem     Use%</span><br><span class="line">-----------------------</span><br><span class="line">/                   24%</span><br><span class="line">/backup             62%</span><br><span class="line">/project            21%</span><br><span class="line">memory           26.33%</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="监控磁盘使用率"><a href="#监控磁盘使用率" class="headerlink" title="监控磁盘使用率"></a>监控磁盘使用率</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Python实现的监测服务器硬盘使用率</span><br><span class="line">此脚本主要用于zabbix监控系统硬盘只用，适用于windows和linux系统，返回值为0为正常，有几个分区的硬盘剩余少于10G或</span><br><span class="line">低于10%就为报警阀值（windows的C盘和linux的根分区除外）：</span><br><span class="line">import platform </span><br><span class="line">import commands </span><br><span class="line">  </span><br><span class="line">def w_disk(): </span><br><span class="line">    import wmi </span><br><span class="line">    c = wmi.WMI () </span><br><span class="line">    i = 0</span><br><span class="line">    for disk in c.Win32_LogicalDisk (DriveType=3): </span><br><span class="line">        a = int(disk.FreeSpace) / (1024*1024*1024) </span><br><span class="line">        b = int(100.0 * long (disk.FreeSpace) / long (disk.Size)) </span><br><span class="line">        if disk.Caption == &quot;C:&quot;: </span><br><span class="line">            if (a &lt; 2) or (b &lt; 10): </span><br><span class="line">                i += 1</span><br><span class="line">            else: </span><br><span class="line">                i += 0</span><br><span class="line">        else: </span><br><span class="line">            if (a &lt; 10) or (b &lt; 10): </span><br><span class="line">                i += 1</span><br><span class="line">            else: </span><br><span class="line">                i += 0</span><br><span class="line">    print i </span><br><span class="line">  </span><br><span class="line">def L_disk(): </span><br><span class="line">    free = commands.getstatusoutput(&#x27;df -h|grep dev|egrep -v &quot;tmp|var|shm&quot;&#x27;) </span><br><span class="line">    list = free[1].split(&#x27;\n&#x27;) </span><br><span class="line">    i = 0</span><br><span class="line">    for disk in range(len(list)): </span><br><span class="line">        vd = list[disk][6:8] </span><br><span class="line">        a = list[disk].split()[3] </span><br><span class="line">        if a[-1] == &#x27;T&#x27;: </span><br><span class="line">            a = int(float(a[:-1]))*1024</span><br><span class="line">        else: </span><br><span class="line">            a = int(float(a[:-1])) </span><br><span class="line">        b = 100 - int(list[disk].split()[4][:-1]) </span><br><span class="line">        if vd == &quot;da&quot;: </span><br><span class="line">            if (a &lt; 2) or (b &lt; 10): </span><br><span class="line">                i += 1</span><br><span class="line">            else: </span><br><span class="line">                i += 0</span><br><span class="line">        else: </span><br><span class="line">            if (a &lt; 10) or (b &lt; 10): </span><br><span class="line">                i += 1</span><br><span class="line">            else: </span><br><span class="line">                i += 0</span><br><span class="line">    print i </span><br><span class="line">  </span><br><span class="line">if __name__ == &quot;__main__&quot;: </span><br><span class="line">    os = platform.system() </span><br><span class="line">    if os == &quot;Windows&quot;: </span><br><span class="line">        w_disk() </span><br><span class="line">    elif os == &quot;Linux&quot;: </span><br><span class="line">        L_disk() </span><br></pre></td></tr></table></figure>

<h4 id="python脚本监控Linux磁盘空间使用率"><a href="#python脚本监控Linux磁盘空间使用率" class="headerlink" title="python脚本监控Linux磁盘空间使用率"></a>python脚本监控Linux磁盘空间使用率</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">#cat check_snmp_storage.py</span><br><span class="line">#_*_ coding: utf-8 _*_</span><br><span class="line"></span><br><span class="line">from sys import argv,exit</span><br><span class="line">from decimal import Decimal</span><br><span class="line">from optparse import OptionParser</span><br><span class="line">from netsnmp import snmpwalk</span><br><span class="line"></span><br><span class="line">parser = OptionParser(&#x27;%prog -C -H -d -w -c &#x27;)</span><br><span class="line"></span><br><span class="line">parser.add_option(&#x27;-H&#x27;, &#x27;--HostAddr&#x27;, action=&#x27;store&#x27;, dest=&#x27;hostaddress&#x27;, help=&#x27;Specify HostAddress&#x27;)</span><br><span class="line">parser.add_option(&#x27;-C&#x27;, &#x27;--community&#x27;, action=&#x27;store&#x27;, dest=&#x27;community&#x27;, help=&#x27;Specify host community&#x27;)</span><br><span class="line">parser.add_option(&#x27;-d&#x27;, &#x27;--device&#x27;, action=&#x27;store&#x27;, dest=&#x27;device&#x27;, help=&#x27;Specify a device&#x27;)</span><br><span class="line">parser.add_option(&#x27;-w&#x27;, &#x27;--warning&#x27;, action=&#x27;store&#x27;, dest=&#x27;warning&#x27;, help=&#x27;set the warning value&#x27;)</span><br><span class="line">parser.add_option(&#x27;-c&#x27;, &#x27;--critical&#x27;, action=&#x27;store&#x27;, dest=&#x27;critical&#x27;, help=&#x27;set the critical value&#x27;)</span><br><span class="line"></span><br><span class="line">(options, argvs) = parser.parse_args(argv)</span><br><span class="line"></span><br><span class="line">desc_list = [&#x27;hrStorageDescr&#x27;, &#x27;hrStorageSize&#x27;, &#x27;hrStorageUsed&#x27;, &#x27;hrStorageAllocationUnits&#x27;]</span><br><span class="line"></span><br><span class="line">#依次获取desc_list对应的返回值，并分别存入列表</span><br><span class="line">try:</span><br><span class="line">    for mibdsc in desc_list:</span><br><span class="line">        r1 = list(snmpwalk(mibdsc,Version=2,Community=options.community,DestHost=options.hostaddress))</span><br><span class="line">        if mibdsc == &#x27;hrStorageDescr&#x27;:</span><br><span class="line">            dev = r1</span><br><span class="line">        elif mibdsc == &#x27;hrStorageSize&#x27;:</span><br><span class="line">            size = r1</span><br><span class="line">        elif mibdsc == &#x27;hrStorageUsed&#x27;:</span><br><span class="line">            used = r1</span><br><span class="line">        elif mibdsc == &#x27;hrStorageAllocationUnits&#x27;:</span><br><span class="line">            units = r1</span><br><span class="line">except TypeError:</span><br><span class="line">    parser.print_help()</span><br><span class="line">    exit(3)</span><br><span class="line">    </span><br><span class="line">size_list = &#123;&#125;</span><br><span class="line">used_list = &#123;&#125;</span><br><span class="line">per_list = &#123;&#125;</span><br><span class="line">for devname in dev:</span><br><span class="line">    l = dev.index(devname) #依次获取该元素在列表的位置</span><br><span class="line">    dev_size = int(size[l]) * int(units[l]) / 1024 / 1024 #将磁盘容量单位转为M</span><br><span class="line">    dev_used = int(used[l]) * int(units[l]) / 1024 / 1024</span><br><span class="line">    used_percent = round(float(dev_used) / float(dev_size),2) * 100</span><br><span class="line"></span><br><span class="line">    size_list[devname] = dev_size</span><br><span class="line">    used_list[devname] = dev_used</span><br><span class="line">    per_list[devname] = used_percent</span><br><span class="line"></span><br><span class="line">if float(options.warning) &gt; float(options.critical):</span><br><span class="line">    print &quot;-w &lt;阀值&gt; 必须等于或小于 -c &lt;阀值&gt;&quot;</span><br><span class="line">    exit(3)</span><br><span class="line">try:</span><br><span class="line">    if float(per_list[options.device]) &lt; float(options.warning):</span><br><span class="line">        print &#x27;OK - &quot;%s&quot; 使用了:%s%% | 总容量:%s MB,已使用:%s MB (w:%s%%, c:%s%%)&#x27; % (options.device, per_list[options.device], size_list[options.device], used_list[options.device], options.warning, options.critical)</span><br><span class="line">        exit(0)</span><br><span class="line">    elif float(options.critical) &gt; float(per_list[options.device]) &gt;= float(options.warning):</span><br><span class="line">        print &#x27;Warning - &quot;%s&quot; 使用了:%s%% | 总容量:%s MB , 已使用:%s MB (w:%s%%, c:%s%%)&#x27; % (options.device, per_list[options.device], size_list[options.device], used_list[options.device], options.warning, options.critical)</span><br><span class="line">        exit(1)</span><br><span class="line">    elif float(per_list[options.device]) &gt;= float(options.critical):</span><br><span class="line">        print &#x27;Critical - &quot;%s&quot; 使用了:%s%% | 总容量:%s MB , 已使用:%s MB (w:%s%%, c:%s%%)&#x27; % (options.device, per_list[options.device], size_list[options.device], used_list[options.device], options.warning, options.critical)</span><br><span class="line">        exit(2)</span><br><span class="line">except KeyError:</span><br><span class="line">    print &#x27;无响应或指定的文件系统不存在&#x27;</span><br><span class="line">    exit(3)</span><br><span class="line">    </span><br><span class="line">将脚本check_snmp_storage.py放到/usr/local/nagios/libexec目录下,给执行权限。直接执行脚本可以看到脚本的用法：</span><br><span class="line"></span><br><span class="line">#python check_snmp_storage.py -h</span><br><span class="line">usage: check_snmp_storage.py -C -H -d -w -c</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -H HOSTADDRESS, --HostAddr=HOSTADDRESS</span><br><span class="line">                        Specify HostAddress</span><br><span class="line">  -C COMMUNITY, --community=COMMUNITY</span><br><span class="line">                        Specify host community</span><br><span class="line">  -d DEVICE, --device=DEVICE</span><br><span class="line">                        Specify a device</span><br><span class="line">  -w WARNING, --warning=WARNING</span><br><span class="line">                        set the warning value</span><br><span class="line">  -c CRITICAL, --critical=CRITICAL</span><br><span class="line">                        set the critical value</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">commands.cfg配置如下：</span><br><span class="line">define command&#123;</span><br><span class="line">  command_name check_snmp_storage</span><br><span class="line">  command_line $USER1$/check_snmp_storage.py $ARG1$ -H $HOSTADDRESS$ $ARG2$ $ARG3$ $ARG4$</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">services.cfg配置如下：</span><br><span class="line">define service&#123;</span><br><span class="line">        use                             service02</span><br><span class="line">        host_name                       test</span><br><span class="line">        service_description             /data       </span><br><span class="line">        check_command                   check_snmp_storage!-C public!-d /data!-w 85!-c 90</span><br><span class="line">       &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Python获取CPU使用率、内存使用率、网络使用状态"><a href="#Python获取CPU使用率、内存使用率、网络使用状态" class="headerlink" title="Python获取CPU使用率、内存使用率、网络使用状态"></a>Python获取CPU使用率、内存使用率、网络使用状态</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">注：需要安装psutil库</span><br><span class="line">import sys  </span><br><span class="line">import os   </span><br><span class="line">  </span><br><span class="line">import atexit  </span><br><span class="line">import time   </span><br><span class="line">import psutil  </span><br><span class="line">  </span><br><span class="line">#print &quot;Welcome,current system is&quot;,os.name,&quot; 3 seconds late start to get data...&quot;      </span><br><span class="line">time.sleep(3)  </span><br><span class="line">  </span><br><span class="line">line_num = 1  </span><br><span class="line">  </span><br><span class="line">#function of Get CPU State;  </span><br><span class="line">def getCPUstate(interval=1):  </span><br><span class="line">    return (&quot; CPU: &quot; + str(psutil.cpu_percent(interval)) + &quot;%&quot;)      </span><br><span class="line">#function of Get Memory      </span><br><span class="line">def getMemorystate():   </span><br><span class="line">        phymem = psutil.virtual_memory()  </span><br><span class="line">        line = &quot;Memory: %5s%% %6s/%s&quot;%(  </span><br><span class="line">            phymem.percent,  </span><br><span class="line">            str(int(phymem.used/1024/1024))+&quot;M&quot;,  </span><br><span class="line">            str(int(phymem.total/1024/1024))+&quot;M&quot;  </span><br><span class="line">            )  </span><br><span class="line">        return line      </span><br><span class="line">def bytes2human(n):      </span><br><span class="line">        &quot;&quot;&quot;    </span><br><span class="line">        &gt;&gt;&gt; bytes2human(10000)    </span><br><span class="line">        &#x27;9.8 K&#x27;    </span><br><span class="line">        &gt;&gt;&gt; bytes2human(100001221)    </span><br><span class="line">        &#x27;95.4 M&#x27;    </span><br><span class="line">        &quot;&quot;&quot;      </span><br><span class="line">        symbols = (&#x27;K&#x27;, &#x27;M&#x27;, &#x27;G&#x27;, &#x27;T&#x27;, &#x27;P&#x27;, &#x27;E&#x27;, &#x27;Z&#x27;, &#x27;Y&#x27;)      </span><br><span class="line">        prefix = &#123;&#125;      </span><br><span class="line">        for i, s in enumerate(symbols):      </span><br><span class="line">                prefix[s] = 1 &lt;&lt; (i+1)*10      </span><br><span class="line">        for s in reversed(symbols):      </span><br><span class="line">                if n &gt;= prefix[s]:      </span><br><span class="line">                        value = float(n) / prefix[s]      </span><br><span class="line">                        return &#x27;%.2f %s&#x27; % (value, s)      </span><br><span class="line">        return &#x27;%.2f B&#x27; % (n)      </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">def poll(interval):      </span><br><span class="line">        &quot;&quot;&quot;Retrieve raw stats within an interval window.&quot;&quot;&quot;      </span><br><span class="line">        tot_before = psutil.net_io_counters()      </span><br><span class="line">        pnic_before = psutil.net_io_counters(pernic=True)      </span><br><span class="line">        # sleep some time      </span><br><span class="line">        time.sleep(interval)      </span><br><span class="line">        tot_after = psutil.net_io_counters()      </span><br><span class="line">        pnic_after = psutil.net_io_counters(pernic=True)      </span><br><span class="line">        # get cpu state      </span><br><span class="line">        cpu_state = getCPUstate(interval)      </span><br><span class="line">        # get memory      </span><br><span class="line">        memory_state = getMemorystate()      </span><br><span class="line">        return (tot_before, tot_after, pnic_before, pnic_after,cpu_state,memory_state)      </span><br><span class="line">        </span><br><span class="line">def refresh_window(tot_before, tot_after, pnic_before, pnic_after,cpu_state,memory_state):      </span><br><span class="line">        if os.name == &#x27;nt&#x27;:  </span><br><span class="line">            os.system(&quot;cls&quot;)      </span><br><span class="line">        else:  </span><br><span class="line">            os.system(&quot;clear&quot;)      </span><br><span class="line">        &quot;&quot;&quot;Print stats on screen.&quot;&quot;&quot;      </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        #print current time #cpu state #memory      </span><br><span class="line">        print(time.asctime()+&quot; | &quot;+cpu_state+&quot; | &quot;+memory_state)      </span><br><span class="line">                </span><br><span class="line">        # totals      </span><br><span class="line">        print(&quot; NetStates:&quot;)      </span><br><span class="line">        print(&quot;total bytes:                     sent: %-10s     received: %s&quot; % (bytes2human(tot_after.bytes_sent),      </span><br><span class="line">                                                                                                                                            bytes2human(tot_after.bytes_recv))      </span><br><span class="line">        )      </span><br><span class="line">        print(&quot;total packets:                 sent: %-10s     received: %s&quot; % (tot_after.packets_sent,     </span><br><span class="line">                                                                                                                                            tot_after.packets_recv)      </span><br><span class="line">        )  </span><br><span class="line">        # per-network interface details: let&#x27;s sort network interfaces so      </span><br><span class="line">        # that the ones which generated more traffic are shown first      </span><br><span class="line">        print(&quot;&quot;)      </span><br><span class="line">        nic_names = pnic_after.keys()      </span><br><span class="line">        #nic_names.sort(key=lambda x: sum(pnic_after[x]), reverse=True)      </span><br><span class="line">        for name in nic_names:      </span><br><span class="line">                stats_before = pnic_before[name]      </span><br><span class="line">                stats_after = pnic_after[name]      </span><br><span class="line">                templ = &quot;%-15s %15s %15s&quot;      </span><br><span class="line">                print(templ % (name, &quot;TOTAL&quot;, &quot;PER-SEC&quot;))      </span><br><span class="line">                print(templ % (      </span><br><span class="line">                        &quot;bytes-sent&quot;,      </span><br><span class="line">                        bytes2human(stats_after.bytes_sent),      </span><br><span class="line">                        bytes2human(stats_after.bytes_sent - stats_before.bytes_sent) + &#x27;/s&#x27;,      </span><br><span class="line">                ))      </span><br><span class="line">                print(templ % (      </span><br><span class="line">                        &quot;bytes-recv&quot;,      </span><br><span class="line">                        bytes2human(stats_after.bytes_recv),      </span><br><span class="line">                        bytes2human(stats_after.bytes_recv - stats_before.bytes_recv) + &#x27;/s&#x27;,      </span><br><span class="line">                ))      </span><br><span class="line">                print(templ % (      </span><br><span class="line">                        &quot;pkts-sent&quot;,      </span><br><span class="line">                        stats_after.packets_sent,      </span><br><span class="line">                        stats_after.packets_sent - stats_before.packets_sent,      </span><br><span class="line">                ))      </span><br><span class="line">                print(templ % (      </span><br><span class="line">                        &quot;pkts-recv&quot;,      </span><br><span class="line">                        stats_after.packets_recv,      </span><br><span class="line">                        stats_after.packets_recv - stats_before.packets_recv,      </span><br><span class="line">                ))      </span><br><span class="line">                print(&quot;&quot;)      </span><br><span class="line">        </span><br><span class="line">try:      </span><br><span class="line">        interval = 0      </span><br><span class="line">        while 1:      </span><br><span class="line">                args = poll(interval)      </span><br><span class="line">                refresh_window(*args)  </span><br><span class="line">                interval = 1      </span><br><span class="line">except (KeyboardInterrupt, SystemExit):      </span><br><span class="line">        pass  </span><br></pre></td></tr></table></figure>

<h4 id="获取文件夹大小"><a href="#获取文件夹大小" class="headerlink" title="获取文件夹大小"></a>获取文件夹大小</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">获取文件夹大小</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">from os.path import join, getsize</span><br><span class="line"></span><br><span class="line">def getdirsize(dir):</span><br><span class="line">   size = 0L</span><br><span class="line">   for root, dirs, files in os.walk(dir):</span><br><span class="line">      size += sum([getsize(join(root, name)) for name in files])</span><br><span class="line">   return size</span><br><span class="line"></span><br><span class="line">if &#x27;__name__&#x27; == &#x27;__main__&#x27;:</span><br><span class="line">   filesize = getdirsize(r&#x27;c:\windows&#x27;)</span><br><span class="line">   print &#x27;There are %.3f&#x27; % (size/1024/1024), &#x27;Mbytes in c:\\windows&#x27;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   [x+1 for x in range(10)]</span><br></pre></td></tr></table></figure>

<h2 id="sys模块"><a href="#sys模块" class="headerlink" title="sys模块"></a>sys模块</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">　 sys.argv              命令行参数List，第一个元素是程序本身路径 </span><br><span class="line">　　sys.modules.keys() 返回所有已经导入的模块列表 </span><br><span class="line">　　sys.exc_info()     获取当前正在处理的异常类,exc_type、exc_value、exc_traceback当前处理的异常详细信息 </span><br><span class="line">　　sys.exit(n)          退出程序，正常退出时exit(0) </span><br><span class="line">　　sys.hexversion   获取Python解释程序的版本值，16进制格式如：0x020403F0 </span><br><span class="line">　　sys.version         获取Python解释程序的版本信息 </span><br><span class="line">　　sys.maxint          最大的Int值 </span><br><span class="line">　　sys.maxunicode 最大的Unicode值 </span><br><span class="line">　　sys.modules        返回系统导入的模块字段，key是模块名，value是模块 </span><br><span class="line">　　sys.path              返回模块的搜索路径，初始化时使用PYTHONPATH环境变量的值 </span><br><span class="line">　　sys.platform        返回操作系统平台名称 </span><br><span class="line">　　sys.stdout           标准输出</span><br><span class="line">　　sys.stdin              标准输入</span><br><span class="line">　　sys.stderr             错误输出</span><br><span class="line">　　sys.exc_clear()    用来清除当前线程所出现的当前的或最近的错误信息</span><br><span class="line">　　sys.exec_prefix    返回平台独立的python文件安装的位置</span><br><span class="line">　　sys.byteorder      本地字节规则的指示器，big-endian平台的值是&#x27;big&#x27;,little-endian平台的值是&#x27;little&#x27;</span><br><span class="line">　　sys.copyright       记录python版权相关的东西</span><br><span class="line">　　sys.api_version    解释器的C的API版本</span><br><span class="line">　　sys.version_info </span><br><span class="line">　　sys.displayhook(value)         如果value非空，这个函数会把他输出到sys.stdout，并且将他保存进__builtin__._.指在python的交互式解释器里，&#x27;_&#x27;代表上次你输入得到的结果，hook是钩子的意思，将上次的结果钩过来</span><br><span class="line">　　sys.getdefaultencoding()         返回当前你所用的默认的字符编码格式</span><br><span class="line">　　sys.getfilesystemencoding()    返回将Unicode文件名转换成系统文件名的编码的名字</span><br><span class="line">　　sys.setdefaultencoding(name) 用来设置当前默认的字符编码，如果name和任何一个可用的编码都不匹配，抛出LookupError，这个函数只会被site模块的sitecustomize使用，一旦被site模块使用了，他会从sys模块移除</span><br><span class="line">　　sys.builtin_module_names    Python解释器导入的模块列表 </span><br><span class="line">　　sys.executable                       Python解释程序路径 </span><br><span class="line">　　sys.getwindowsversion()       获取Windows的版本 </span><br><span class="line">　　sys.stdin.readline()                从标准输入读一行，sys.stdout.write(&quot;a&quot;) 屏幕输出a </span><br><span class="line"></span><br><span class="line">python之sys模块详解</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">sys.argv: </span><br><span class="line">实现从程序外部向程序传递参数。</span><br><span class="line">示例：sys.py</span><br><span class="line">    #!/usr/bin/env python</span><br><span class="line">    import sys</span><br><span class="line">    print sys.argv[0]</span><br><span class="line">    print sys.argv[1]</span><br><span class="line">    运行：</span><br><span class="line">    # python sys.py argv1</span><br><span class="line">    sys.py</span><br><span class="line">    argv1</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">sys.exit([arg]): </span><br><span class="line">功能：执行到主程序末尾，解释器自动退出，但是如果需要中途退出程序，可以调用sys.exit函数，带有</span><br><span class="line">一个可选的整数参数返回给调用它的程序，表示你可以在主程序中捕获对sys.exit的调用。（0是正常退</span><br><span class="line">出，其他(1-127)为异常）</span><br><span class="line"></span><br><span class="line">例：exit.py</span><br><span class="line">    #!/usr/bin/env python</span><br><span class="line">    import sys</span><br><span class="line">    def exitfunc(value):</span><br><span class="line">        print value</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">    print &quot;hello&quot;</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        sys.exit(1)</span><br><span class="line">    except SystemExit,value:</span><br><span class="line">        exitfunc(value)</span><br><span class="line"></span><br><span class="line">    print &quot;come&quot;     </span><br><span class="line"></span><br><span class="line">运行：</span><br><span class="line"># python exit.py</span><br><span class="line">hello</span><br><span class="line">1</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">sys.path</span><br><span class="line">获取指定模块搜索路径的字符串集合，可以将写好的模块放在得到的某个路径下，就可以在程序中import时</span><br><span class="line">正确找到。</span><br><span class="line">例：</span><br><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path</span><br><span class="line">[&#x27;&#x27;, &#x27;/usr/lib/python2.7&#x27;, &#x27;/usr/lib/python2.7/plat-x86_64-linux-gnu&#x27;, &#x27;/usr/lib/python2.7/lib-tk&#x27;, &#x27;/</span><br><span class="line">usr/lib/python2.7/lib-old&#x27;, &#x27;/usr/lib/python2.7/lib-dynload&#x27;, &#x27;/usr/local/lib/python2.7/dist-</span><br><span class="line">packages&#x27;, &#x27;/usr/lib/python2.7/dist-packages&#x27;, &#x27;/usr/lib/python2.7/dist-packages/PILcompat&#x27;, &#x27;/</span><br><span class="line">usr/lib/python2.7/dist-packages/gtk-2.0&#x27;, &#x27;/usr/lib/python2.7/dist-packages/ubuntu-sso-client&#x27;]</span><br><span class="line"></span><br><span class="line">有时候为了让python能够找到我们自己定义的模块，需要修改sys.path的内容，比如：</span><br><span class="line"></span><br><span class="line"># 在path的开始位置插入test</span><br><span class="line">&gt;&gt;&gt; sys.path.insert(0,&#x27;test&#x27;)</span><br><span class="line">&gt;&gt;&gt; sys.path</span><br><span class="line">[&#x27;test&#x27;, &#x27;&#x27;, &#x27;E:\\Python27\\Lib\\idlelib&#x27;, &#x27;C:\\Windows\\system32\\python27.zip&#x27;, &#x27;E:\\Python27\</span><br><span class="line">\DLLs&#x27;, &#x27;E:\\Python27\\lib&#x27;, &#x27;E:\\Python27\\lib\\plat-win&#x27;, &#x27;E:\\Python27\\lib\\lib-tk&#x27;, &#x27;E:\</span><br><span class="line">\Python27&#x27;, &#x27;E:\\Python27\\lib\\site-packages&#x27;]</span><br><span class="line"></span><br><span class="line"># 可以成功import test</span><br><span class="line">&gt;&gt;&gt; import test</span><br><span class="line"></span><br><span class="line"># 找不到 other 这个模块</span><br><span class="line">&gt;&gt;&gt; import other</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;pyshell#10&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">    import other</span><br><span class="line">ImportError: No module named other</span><br><span class="line"></span><br><span class="line"># 需要添加path</span><br><span class="line">&gt;&gt;&gt; sys.path.insert(0,&#x27;other&#x27;)</span><br><span class="line">&gt;&gt;&gt; import other</span><br><span class="line"></span><br><span class="line">也可以用sys.path.append(“mine module path”)来添加自定义的module。</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">sys.platform</span><br><span class="line">获取当前执行环境的平台，如win32表示是Windows 32bit操作系统，linux2表示是linux平台</span><br><span class="line">    # linux </span><br><span class="line">    &gt;&gt;&gt; import sys</span><br><span class="line">    &gt;&gt;&gt; sys.platform</span><br><span class="line">    &#x27;linux2&#x27;</span><br><span class="line"></span><br><span class="line">    # windows</span><br><span class="line">    &gt;&gt;&gt; import sys</span><br><span class="line">    &gt;&gt;&gt; sys.platform</span><br><span class="line">    &#x27;win32&#x27;</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">sys.stdin,sys.stdout,sys.stderr:</span><br><span class="line">stdin , stdout , 以及stderr 变量包含与标准I/O 流对应的流对象. 如果需要更好地控制输出,而print不能满</span><br><span class="line">足你的要求, 它们就是你所需要的. 你也可以替换它们, 这时候你就可以重定向输出和输入到其它设备</span><br><span class="line">( device ), 或者以非标准的方式处理它们</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">sys.modules</span><br><span class="line">功能：sys.modules是一个全局字典，该字典是python启动后就加载在内存中。每当程序员导入新的模</span><br><span class="line">块，sys.modules将自动记录该模块。当第二次再导入该模块时，python会直接到字典中查找，从而加快</span><br><span class="line">了程序运行的速度。它拥有字典所拥有的一切方法。</span><br><span class="line"></span><br><span class="line">例：modules.py</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">import sys</span><br><span class="line">print sys.modules.keys()</span><br><span class="line">print sys.modules.values()</span><br><span class="line">print sys.modules[&quot;os&quot;]</span><br><span class="line"></span><br><span class="line">运行：</span><br><span class="line">python modules.py</span><br><span class="line">[&#x27;copy_reg&#x27;, &#x27;sre_compile&#x27;, &#x27;_sre&#x27;, &#x27;encodings&#x27;, &#x27;site&#x27;, &#x27;__builtin__&#x27;,......</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">sys.builtin_module_names</span><br><span class="line">sys.builtin_module_names返回一个列表，包含内建模块的名字。如：</span><br><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; print sys.builtin_module_names</span><br><span class="line">(&#x27;__builtin__&#x27;, &#x27;__main__&#x27;, &#x27;_ast&#x27;, &#x27;_bisect&#x27;, &#x27;_codecs&#x27;, &#x27;_codecs_cn&#x27;, &#x27;_codecs_hk&#x27;, </span><br><span class="line">&#x27;_codecs_iso2022&#x27;, &#x27;_codecs_jp&#x27;, &#x27;_codecs_kr&#x27;, &#x27;_codecs_tw&#x27;, &#x27;_collections&#x27;, &#x27;_csv&#x27;, &#x27;_functools&#x27;, </span><br><span class="line">&#x27;_heapq&#x27;, &#x27;_hotshot&#x27;, &#x27;_io&#x27;, &#x27;_json&#x27;, &#x27;_locale&#x27;, &#x27;_lsprof&#x27;, &#x27;_md5&#x27;, &#x27;_multibytecodec&#x27;, &#x27;_random&#x27;, &#x27;_sha&#x27;, </span><br><span class="line">&#x27;_sha256&#x27;, &#x27;_sha512&#x27;, &#x27;_sre&#x27;, &#x27;_struct&#x27;, &#x27;_subprocess&#x27;, &#x27;_symtable&#x27;, &#x27;_warnings&#x27;, &#x27;_weakref&#x27;, </span><br><span class="line">&#x27;_winreg&#x27;, &#x27;array&#x27;, &#x27;audioop&#x27;, &#x27;binascii&#x27;, &#x27;cPickle&#x27;, &#x27;cStringIO&#x27;, &#x27;cmath&#x27;, &#x27;datetime&#x27;, &#x27;errno&#x27;, </span><br><span class="line">&#x27;exceptions&#x27;, &#x27;future_builtins&#x27;, &#x27;gc&#x27;, &#x27;imageop&#x27;, &#x27;imp&#x27;, &#x27;itertools&#x27;, &#x27;marshal&#x27;, &#x27;math&#x27;, &#x27;mmap&#x27;, </span><br><span class="line">&#x27;msvcrt&#x27;, &#x27;nt&#x27;, &#x27;operator&#x27;, &#x27;parser&#x27;, &#x27;signal&#x27;, &#x27;strop&#x27;, &#x27;sys&#x27;, &#x27;thread&#x27;, &#x27;time&#x27;, &#x27;xxsubtype&#x27;, &#x27;zipimport&#x27;, </span><br><span class="line">&#x27;zlib&#x27;)</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">    # encoding: utf-8</span><br><span class="line">    # find_module.py</span><br><span class="line">    import sys</span><br><span class="line">    # print sys.builtin_module_names</span><br><span class="line">    def find_module(module):</span><br><span class="line">        if module in sys.builtin_module_names:</span><br><span class="line">            print module,&quot; =&gt; &quot;,&quot;__builtin__&quot;</span><br><span class="line">        else:</span><br><span class="line">            print module,&quot;=&gt; &quot;,__import__(module).__file__</span><br><span class="line"></span><br><span class="line">    find_module(&#x27;os&#x27;)</span><br><span class="line">    find_module(&#x27;sys&#x27;)</span><br><span class="line">    find_module(&#x27;strop&#x27;)</span><br><span class="line">    find_module(&#x27;zlib&#x27;)</span><br><span class="line">    find_module(&#x27;string&#x27;)</span><br><span class="line"></span><br><span class="line"># 运行结果：</span><br><span class="line">    os =&gt;  E:\Python27\lib\os.pyc</span><br><span class="line">    sys  =&gt;  __builtin__</span><br><span class="line">    strop  =&gt;  __builtin__</span><br><span class="line">    zlib  =&gt;  __builtin__</span><br><span class="line">    string =&gt;  E:\Python27\lib\string.pyc</span><br></pre></td></tr></table></figure>

<h3 id="获取管道输入数据"><a href="#获取管道输入数据" class="headerlink" title="获取管道输入数据"></a>获取管道输入数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">使用sys.stdin.read来获取管道的输入。</span><br><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line">import sys</span><br><span class="line">a=sys.stdin.read()</span><br><span class="line">print a,</span><br><span class="line"></span><br><span class="line">[root@master ~]# echo hello | python b.py</span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">为什么多了一个空行。这是因为echo本身会给文本加换行符，而print函数又加了一个。</span><br><span class="line">python3给print一个end=&quot;&quot;参数就可以了。即，print(&quot;来自Python的:&quot;, sys.stdin.read(), end=&quot;&quot;) python2在最后加一个逗号就可以</span><br><span class="line"></span><br><span class="line">获取数据行数脚本：</span><br><span class="line">[root@master ~]# cat count.py </span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">import sys</span><br><span class="line">bi = sys.stdin.read()</span><br><span class="line">li = bi.split(&quot;\n&quot;)[:-1]</span><br><span class="line">print len(li)</span><br><span class="line"></span><br><span class="line">[root@master ~]# ls | python count.py </span><br><span class="line">22</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="文件重定向"><a href="#文件重定向" class="headerlink" title="文件重定向"></a>文件重定向</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br></pre></td><td class="code"><pre><span class="line">在Python中，文件对象sys.stdin、sys.stdout和sys.stderr分别对应解释器的标准输入、标准输出和标准</span><br><span class="line">出错流。</span><br><span class="line"></span><br><span class="line">打开一个普通文件：</span><br><span class="line">In [3]: f = open(&quot;a.txt&quot;,&#x27;w&#x27;)</span><br><span class="line">In [4]: f</span><br><span class="line">Out[4]: &lt;open file &#x27;a.txt&#x27;, mode &#x27;w&#x27; at 0x243b660&gt;</span><br><span class="line"></span><br><span class="line">sys.stdin、sys.stdout和sys.stderr是3个已经被打开的文件：</span><br><span class="line">In [2]: for fd in (sys.stdout,sys.stderr,sys.stdin):</span><br><span class="line">   ...:     print fd</span><br><span class="line">   ...:     </span><br><span class="line">&lt;open file &#x27;&lt;stdout&gt;&#x27;, mode &#x27;w&#x27; at 0x7fdfd8511150&gt;</span><br><span class="line">&lt;open file &#x27;&lt;stderr&gt;&#x27;, mode &#x27;w&#x27; at 0x7fdfd85111e0&gt;</span><br><span class="line">&lt;open file &#x27;&lt;stdin&gt;&#x27;, mode &#x27;r&#x27; at 0x7fdfd85110c0&gt;</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">print语句不以逗号结尾时，会在输出字符串尾部自动附加一个换行符(linefeed)；否则将一个空</span><br><span class="line">格代替附加的换行符。print语句默认写入标准输出流，也可重定向至文件或其他可写对象(所有提</span><br><span class="line">供write方法的对象)。这样，就可以使用简洁的print语句代替笨拙的object.write(&#x27;hello&#x27;+&#x27;\n&#x27;)</span><br><span class="line">写法。</span><br><span class="line">由上可知，在Python中调用print obj打印对象时，缺省情况下等效于调用sys.stdout.write(obj</span><br><span class="line">+&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">示例如下：</span><br><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; print &#x27;Hello World&#x27;</span><br><span class="line">Hello World</span><br><span class="line">&gt;&gt;&gt; sys.stdout.write(&#x27;Hello World&#x27;)</span><br><span class="line">Hello World</span><br><span class="line"></span><br><span class="line">[root@master ~]# cat a.py</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">import sys</span><br><span class="line">sys.stdout.write(&#x27;hello&#x27;)</span><br><span class="line">[root@master ~]# python a.py</span><br><span class="line">hello[root@master ~]# </span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">重定向方式</span><br><span class="line">常用的Python标准输出重定向方式有多种。这些方法各有优劣之处，适用于不同的场景。</span><br><span class="line"></span><br><span class="line">控制台重定向</span><br><span class="line">最简单常用的输出重定向方式是利用控制台命令。这种重定向由控制台完成，而与Python本身无</span><br><span class="line">关。</span><br><span class="line">Windows命令提示符(cmd.exe)和Linux Shell(bash等)均通过&quot;&gt;&quot;或&quot;&gt;&gt;&quot;将输出重定向。其</span><br><span class="line">中，&quot;&gt;&quot;表示覆盖内容，&quot;&gt;&gt;&quot;表示追加内容。类似地，&quot;2&gt;&quot;可重定向标准错误。重定向</span><br><span class="line">到&quot;nul&quot;(Windows)或&quot;/dev/null&quot;(Linux)会抑制输出，既不屏显也不存盘。</span><br><span class="line"></span><br><span class="line">以Windows命令提示符为例，将Python脚本输出重定向到文件：</span><br><span class="line">E:\&gt;echo print &#x27;hello&#x27; &gt; test.py</span><br><span class="line">E:\&gt;test.py &gt; out.txt</span><br><span class="line">E:\&gt;type out.txt</span><br><span class="line">hello</span><br><span class="line">E:\&gt;test.py &gt;&gt; out.txt</span><br><span class="line">E:\&gt;type out.txt</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">E:\&gt;test.py &gt; nul</span><br><span class="line"></span><br><span class="line">注意，在Windows命令提示符中执行Python脚本时，命令行无需以&quot;python&quot;开头，系统会根据</span><br><span class="line">脚本后缀自动调用Python解释器。此外，type命令可直接显示文本文件的内容，类似Linux系统</span><br><span class="line">的cat命令。</span><br><span class="line"></span><br><span class="line">Linux Shell中执行Python脚本时，命令行应以&quot;python&quot;开头。除&quot;&gt;&quot;或&quot;&gt;&gt;&quot;重定向外，还可使</span><br><span class="line">用tee命令。该命令可将内容同时输出到终端屏幕和(多个)文件中，&quot;-a&quot;选项表示追加写入，否则</span><br><span class="line">覆盖写入。示例如下(echo $SHELL或echo $0显示当前所使用的Shell)：</span><br><span class="line"></span><br><span class="line">[wing@localhost ~]$ echo $SHELL</span><br><span class="line">/bin/bash</span><br><span class="line">[wing@localhost ~]$ python -c &quot;print &#x27;hello&#x27;&quot;</span><br><span class="line">hello</span><br><span class="line">[wing@localhost ~]$ python -c &quot;print &#x27;hello&#x27;&quot; &gt; out.txt</span><br><span class="line">[wing@localhost ~]$ cat out.txt</span><br><span class="line">hello</span><br><span class="line">[wing@localhost ~]$ python -c &quot;print &#x27;world&#x27;&quot; &gt;&gt; out.txt</span><br><span class="line">[wing@localhost ~]$ cat out.txt             </span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">[wing@localhost ~]$ python -c &quot;print &#x27;I am&#x27;&quot; | tee out.txt</span><br><span class="line">I am</span><br><span class="line">[wing@localhost ~]$ python -c &quot;print &#x27;wing&#x27;&quot; | tee -a out.txt</span><br><span class="line">wing</span><br><span class="line">[wing@localhost ~]$ cat out.txt</span><br><span class="line">I am</span><br><span class="line">wing</span><br><span class="line">[wing@localhost ~]$ python -c &quot;print &#x27;hello&#x27;&quot; &gt; /dev/null</span><br><span class="line"></span><br><span class="line">注意，控制台重定向仅适用于比较简单的输出任务。</span><br><span class="line"></span><br><span class="line">print &gt;&gt;重定向</span><br><span class="line">这种方式基于print语句的扩展形式，即&quot;print obj &gt;&gt; expr&quot;。其中，obj为一个file-like(尤其是</span><br><span class="line">提供write方法的)对象，为None时对应标准输出(sys.stdout)。expr将被输出到该文件对象中。</span><br><span class="line"></span><br><span class="line">示例如下：</span><br><span class="line">memo = cStringIO.StringIO()</span><br><span class="line">serr = sys.stderr</span><br><span class="line">file = open(&#x27;out.txt&#x27;, &#x27;w+&#x27;)</span><br><span class="line">print &gt;&gt;memo, &#x27;StringIO&#x27;</span><br><span class="line">print &gt;&gt;serr, &#x27;stderr&#x27;</span><br><span class="line">print &gt;&gt;file, &#x27;file&#x27;</span><br><span class="line">print &gt;&gt;None, memo.getvalue()</span><br><span class="line">上述代码执行后，屏显为&quot;serr&quot;和&quot;StringIO&quot;(两行，注意顺序)，out.txt文件内写入&quot;file&quot;。</span><br><span class="line">可见，这种方式非常灵活和方便。缺点是不适用于输出语句较多的场景。</span><br><span class="line"></span><br><span class="line">sys.stdout重定向</span><br><span class="line">将一个可写对象(如file-like对象)赋给sys.stdout，可使随后的print语句输出至该对象。重定向结</span><br><span class="line">束后，应将sys.stdout恢复最初的缺省值，即标准输出。</span><br><span class="line"></span><br><span class="line">示例如下：</span><br><span class="line">    import sys</span><br><span class="line">    savedStdout = sys.stdout            #保存标准输出流</span><br><span class="line">    with open(&#x27;out.txt&#x27;, &#x27;w+&#x27;) as file:</span><br><span class="line">        sys.stdout = file                      #标准输出重定向至文件</span><br><span class="line">        print &#x27;This message is for file!&#x27;</span><br><span class="line">    sys.stdout = savedStdout            #恢复标准输出流</span><br><span class="line">    print &#x27;This message is for screen!&#x27;</span><br><span class="line"></span><br><span class="line">注意，IDLE中sys.stdout初值为PseudoOutputFile对象，与sys.__stdout__并不相同。为求</span><br><span class="line">通用，本例另行定义变量(savedStdout)保存sys.stdout，下文也将作此处理。</span><br><span class="line"></span><br><span class="line">以下将自定义多种具有write()方法的file-like对象，以满足不同需求：</span><br><span class="line">    import os, sys, cStringIO</span><br><span class="line">    class RedirectStdout:   </span><br><span class="line">        def __init__(self):</span><br><span class="line">            self.content = &#x27;&#x27;</span><br><span class="line">            self.savedStdout = sys.stdout</span><br><span class="line">            self.memObj, self.fileObj, self.nulObj = None, None, None</span><br><span class="line">        #外部的print语句将执行本write()方法，并由当前sys.stdout输出</span><br><span class="line">        def write(self, outStr):</span><br><span class="line">            #self.content.append(outStr)</span><br><span class="line">            self.content += outStr</span><br><span class="line"> </span><br><span class="line">        def toCons(self): #标准输出重定向至控制台</span><br><span class="line">            sys.stdout = self.savedStdout #sys.__stdout__</span><br><span class="line"> </span><br><span class="line">        def toMemo(self): #标准输出重定向至内存</span><br><span class="line">            self.memObj = cStringIO.StringIO()</span><br><span class="line">            sys.stdout = self.memObj</span><br><span class="line"> </span><br><span class="line">        def toFile(self, file=&#x27;out.txt&#x27;): #标准输出重定向至文件</span><br><span class="line">            self.fileObj = open(file, &#x27;a+&#x27;, 1) #改为行缓冲</span><br><span class="line">            sys.stdout = self.fileObj</span><br><span class="line">   </span><br><span class="line">        def toMute(self): #抑制输出</span><br><span class="line">            self.nulObj = open(os.devnull, &#x27;w&#x27;)</span><br><span class="line">            sys.stdout = self.nulObj</span><br><span class="line">     </span><br><span class="line">        def restore(self):</span><br><span class="line">            self.content = &#x27;&#x27;</span><br><span class="line">            if self.memObj.closed != True:</span><br><span class="line">                self.memObj.close()</span><br><span class="line">            if self.fileObj.closed != True:</span><br><span class="line">                self.fileObj.close()</span><br><span class="line">            if self.nulObj.closed != True:</span><br><span class="line">                self.nulObj.close()</span><br><span class="line">        sys.stdout = self.savedStdout #sys.__stdout__</span><br><span class="line"></span><br><span class="line">注意，toFile()方法中，open(name[, mode[, buffering]])调用选择行缓冲(无缓冲会影响性能)。这是为了观察中间写入过程，否则只有调用close()或flush()后输出才会写入文件。内部调用</span><br><span class="line">open()方法的缺点是不便于用户定制写文件规则，如模式(覆盖或追加)和缓冲(行或全缓冲)。</span><br><span class="line"></span><br><span class="line">重定向效果如下：</span><br><span class="line">redirObj = RedirectStdout()</span><br><span class="line">sys.stdout = redirObj           </span><br><span class="line">#本句会抑制&quot;Let&#x27;s begin!&quot;输出</span><br><span class="line">print &quot;Let&#x27;s begin!&quot;</span><br><span class="line"> </span><br><span class="line">#屏显&#x27;Hello World!&#x27;和&#x27;I am wing.&#x27;(两行)</span><br><span class="line">redirObj.toCons(); print &#x27;Hello World!&#x27;; print &#x27;I am wing.&#x27;</span><br><span class="line">#写入&#x27;How are you?&#x27;和&quot;Can&#x27;t complain.&quot;(两行)</span><br><span class="line">redirObj.toFile(); print &#x27;How are you?&#x27;; print &quot;Can&#x27;t complain.&quot;</span><br><span class="line">redirObj.toCons(); print &quot;What&#x27;up?&quot;   #屏显</span><br><span class="line">redirObj.toMute(); print &#x27;&lt;Silence&gt;&#x27;  #无屏显或写入</span><br><span class="line">os.system(&#x27;echo Never redirect me!&#x27;)  #控制台屏显&#x27;Never redirect me!&#x27;</span><br><span class="line">redirObj.toMemo(); print &#x27;What a pity!&#x27; #无屏显或写入</span><br><span class="line">redirObj.toCons(); print &#x27;Hello?&#x27;    #屏显</span><br><span class="line">redirObj.toFile(); print &quot;Oh, wing can&#x27;t hear me&quot; #该串写入文件</span><br><span class="line">redirObj.restore()</span><br><span class="line"> </span><br><span class="line">print &#x27;Pop up&#x27; #屏显</span><br><span class="line">可见，执行toXXXX()语句后，标准输出流将被重定向到XXXX。此外，toMute()和toMemo()的</span><br><span class="line">效果类似，均可抑制输出。</span><br><span class="line">使用某对象替换sys.stdout时，尽量确保该对象接近文件对象，尤其是涉及第三方库时(该库可能</span><br><span class="line">使用sys.stdout的其他方法)。此外，本节替换sys.stdout的代码实现并不影响由os.popen()、</span><br><span class="line">os.system()或os.exec*()系列方法所创建进程的标准I/O流。</span><br><span class="line"></span><br><span class="line">上下文管理器(Context Manager)</span><br><span class="line">严格意义上并非新的重定向方式，而是利用Pyhton上下文管理器优化上节的代码实现。借助于上</span><br><span class="line">下文管理器语法，可不必向重定向使用者暴露sys.stdout。</span><br><span class="line">首先考虑输出抑制，基于上下文管理器语法实现如下：</span><br><span class="line"></span><br><span class="line">import sys, cStringIO, contextlib</span><br><span class="line">class DummyFile:</span><br><span class="line">  def write(self, outStr): pass</span><br><span class="line"> </span><br><span class="line">@contextlib.contextmanager</span><br><span class="line">def MuteStdout():</span><br><span class="line">  savedStdout = sys.stdout</span><br><span class="line">  sys.stdout = cStringIO.StringIO() #DummyFile()</span><br><span class="line">  try:</span><br><span class="line">    yield</span><br><span class="line">  except Exception: #捕获到错误时，屏显被抑制的输出(该处理并非必需)</span><br><span class="line">    content, sys.stdout = sys.stdout, savedStdout</span><br><span class="line">    print content.getvalue()#; raise</span><br><span class="line">  #finally:</span><br><span class="line">  sys.stdout = savedStdout</span><br><span class="line"></span><br><span class="line">使用示例如下：</span><br><span class="line">with MuteStdout():</span><br><span class="line">  print &quot;I&#x27;ll show up when &lt;raise&gt; is executed!&quot; #不屏显不写入</span><br><span class="line">  raise #屏显上句</span><br><span class="line">  print &quot;I&#x27;m hiding myself somewhere:)&quot; #不屏显再考虑更通用的输出重定向：</span><br><span class="line"></span><br><span class="line">import os, sys</span><br><span class="line">from contextlib import contextmanager</span><br><span class="line">@contextmanager</span><br><span class="line">def RedirectStdout(newStdout):</span><br><span class="line">  savedStdout, sys.stdout = sys.stdout, newStdout</span><br><span class="line">  try:</span><br><span class="line">    yield</span><br><span class="line">  finally:</span><br><span class="line">    sys.stdout = savedStdout</span><br><span class="line">使用示例如下：</span><br><span class="line"></span><br><span class="line">def Greeting(): print &#x27;Hello, boss!&#x27;</span><br><span class="line"> </span><br><span class="line">with open(&#x27;out.txt&#x27;, &quot;w+&quot;) as file:</span><br><span class="line">  print &quot;I&#x27;m writing to you...&quot;   #屏显</span><br><span class="line">  with RedirectStdout(file):</span><br><span class="line">    print &#x27;I hope this letter finds you well!&#x27; #写入文件</span><br><span class="line">  print &#x27;Check your mailbox.&#x27;   #屏显</span><br><span class="line"> </span><br><span class="line">with open(os.devnull, &quot;w+&quot;) as file, RedirectStdout(file):</span><br><span class="line">  Greeting()                                    #不屏显不写入</span><br><span class="line">  print &#x27;I deserve a pay raise:)&#x27;      #不屏显不写入</span><br><span class="line">print &#x27;Did you hear what I said?&#x27;   #屏显</span><br><span class="line">可见，with内嵌块里的函数和print语句输出均被重定向。注意，上述示例不是线程安全的，主要</span><br><span class="line">适用于单线程。</span><br><span class="line">当函数被频繁调用时，建议使用装饰器包装该函数。这样，仅需修改该函数定义，而无需在每次</span><br><span class="line">调用该函数时使用with语句包裹。示例如下：</span><br><span class="line">import sys, cStringIO, functools</span><br><span class="line">def MuteStdout(retCache=False):</span><br><span class="line">  def decorator(func):</span><br><span class="line">    @functools.wraps(func)</span><br><span class="line">    def wrapper(*args, **kwargs):</span><br><span class="line">      savedStdout = sys.stdout</span><br><span class="line">      sys.stdout = cStringIO.StringIO()</span><br><span class="line">      try:</span><br><span class="line">        ret = func(*args, **kwargs)</span><br><span class="line">        if retCache == True:</span><br><span class="line">          ret = sys.stdout.getvalue().strip()</span><br><span class="line">      finally:</span><br><span class="line">        sys.stdout = savedStdout</span><br><span class="line">      return ret</span><br><span class="line">    return wrapper</span><br><span class="line">  return decorator</span><br><span class="line">若装饰器MuteStdout的参数retCache为真，外部调用func()函数时将返回该函数内部print输出的内容(可</span><br><span class="line">供屏显)；若retCache为假，外部调用func()函数时将返回该函数的返回值(抑制输出)。</span><br><span class="line">MuteStdout装饰器使用示例如下：</span><br><span class="line"></span><br><span class="line">@MuteStdout(True)</span><br><span class="line">def Exclaim(): print &#x27;I am proud of myself!&#x27;</span><br><span class="line"> </span><br><span class="line">@MuteStdout()</span><br><span class="line">def Mumble(): print &#x27;I lack confidence...&#x27;; return &#x27;sad&#x27;</span><br><span class="line"> </span><br><span class="line">print Exclaim(), Exclaim.__name__ #屏显&#x27;I am proud of myself! Exclaim&#x27;</span><br><span class="line">print Mumble(), Mumble.__name__  #屏显&#x27;sad Mumble&#x27;</span><br><span class="line">在所有线程中，被装饰函数执行期间，sys.stdout都会被MuteStdout装饰器劫持。而且，函数一经装饰便</span><br><span class="line">无法移除装饰。因此，使用该装饰器时应慎重考虑场景。</span><br><span class="line">接着，考虑创建RedirectStdout装饰器：</span><br><span class="line"></span><br><span class="line">def RedirectStdout(newStdout=sys.stdout):</span><br><span class="line">  def decorator(func):</span><br><span class="line">    def wrapper(*args,**kwargs):</span><br><span class="line">      savedStdout, sys.stdout = sys.stdout, newStdout</span><br><span class="line">      try:</span><br><span class="line">        return func(*args, **kwargs)</span><br><span class="line">      finally:</span><br><span class="line">        sys.stdout = savedStdout</span><br><span class="line">    return wrapper</span><br><span class="line">  return decorator</span><br><span class="line">使用示例如下：</span><br><span class="line">file = open(&#x27;out.txt&#x27;, &quot;w+&quot;)</span><br><span class="line">@RedirectStdout(file)</span><br><span class="line">def FunNoArg(): print &#x27;No argument.&#x27;</span><br><span class="line"> </span><br><span class="line">@RedirectStdout(file)</span><br><span class="line">def FunOneArg(a): print &#x27;One argument:&#x27;, a</span><br><span class="line"> </span><br><span class="line">def FunTwoArg(a, b): print &#x27;Two arguments: %s, %s&#x27; %(a,b)</span><br><span class="line"> </span><br><span class="line">FunNoArg()   #写文件&#x27;No argument.&#x27;</span><br><span class="line">FunOneArg(1984) #写文件&#x27;One argument: 1984&#x27;</span><br><span class="line">RedirectStdout()(FunTwoArg)(10,29) #屏显&#x27;Two arguments: 10, 29&#x27;</span><br><span class="line">print FunNoArg.__name__      #屏显&#x27;wrapper&#x27;(应显示&#x27;FunNoArg&#x27;)</span><br><span class="line"> </span><br><span class="line">file.close()</span><br><span class="line">注意FunTwoArg()函数的定义和调用与其他函数的不同，这是两种等效的语法。此外，RedirectStdout装饰</span><br><span class="line">器的最内层函数wrapper()未使用&quot;functools.wraps(func)&quot;修饰，会丢失被装饰函数原有的特殊属性(如函</span><br><span class="line">数名、文档字符串等)。</span><br><span class="line"></span><br><span class="line">logging模块重定向</span><br><span class="line">对于代码量较大的工程，建议使用logging模块进行输出。该模块是线程安全的，可将日志信息输出</span><br><span class="line">到控制台、写入文件、使用TCP/UDP协议发送到网络等等。</span><br><span class="line">默认情况下logging模块将日志输出到控制台(标准出错)，且只显示大于或等于设置的日志级别的日</span><br><span class="line">志。日志级别由高到低为CRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUG &gt; NOTSET，默认</span><br><span class="line">级别为WARNING。</span><br><span class="line">以下示例将日志信息分别输出到控制台和写入文件：</span><br><span class="line">import logging</span><br><span class="line">logging.basicConfig(level = logging.DEBUG,</span><br><span class="line">  format = &#x27;%(asctime)s [%(levelname)s] at %(filename)s,%(lineno)d: %(message)s&#x27;,</span><br><span class="line">  datefmt = &#x27;%Y-%m-%d(%a)%H:%M:%S&#x27;,</span><br><span class="line">  filename = &#x27;out.txt&#x27;,</span><br><span class="line">  filemode = &#x27;w&#x27;)</span><br><span class="line"> </span><br><span class="line">#将大于或等于INFO级别的日志信息输出到StreamHandler(默认为标准错误)</span><br><span class="line">console = logging.StreamHandler()</span><br><span class="line">console.setLevel(logging.INFO) </span><br><span class="line">formatter = logging.Formatter(&#x27;[%(levelname)-8s] %(message)s&#x27;) #屏显实时查看，无需时间</span><br><span class="line">console.setFormatter(formatter)</span><br><span class="line">logging.getLogger().addHandler(console)</span><br><span class="line"> </span><br><span class="line">logging.debug(&#x27;gubed&#x27;); logging.info(&#x27;ofni&#x27;); logging.critical(&#x27;lacitirc&#x27;)</span><br><span class="line">通过对多个handler设置不同的level参数，可将不同的日志内容输入到不同的地方。本例使用在logging模</span><br><span class="line">块内置的StreamHandler(和FileHandler)，运行后屏幕上显示:</span><br><span class="line"></span><br><span class="line">[INFO  ] ofni</span><br><span class="line">[CRITICAL] lacitirc</span><br><span class="line">out.txt文件内容则为:</span><br><span class="line">2016-05-13(Fri)17:10:53 [DEBUG] at test.py,25: gubed</span><br><span class="line">2016-05-13(Fri)17:10:53 [INFO] at test.py,25: ofni</span><br><span class="line">2016-05-13(Fri)17:10:53 [CRITICAL] at test.py,25: lacitirc</span><br><span class="line">除直接在程序中设置Logger、Handler、Formatter等外，还可将这些信息写入配置文件。</span><br><span class="line">示例如下：</span><br><span class="line">#logger.conf</span><br><span class="line">###############Logger###############</span><br><span class="line">[loggers]</span><br><span class="line">keys=root,Logger2F,Logger2CF</span><br><span class="line"> </span><br><span class="line">[logger_root]</span><br><span class="line">level=DEBUG</span><br><span class="line">handlers=hWholeConsole</span><br><span class="line"> </span><br><span class="line">[logger_Logger2F]</span><br><span class="line">handlers=hWholeFile</span><br><span class="line">qualname=Logger2F</span><br><span class="line">propagate=0</span><br><span class="line"> </span><br><span class="line">[logger_Logger2CF]</span><br><span class="line">handlers=hPartialConsole,hPartialFile</span><br><span class="line">qualname=Logger2CF</span><br><span class="line">propagate=0</span><br><span class="line"> </span><br><span class="line">###############Handler###############</span><br><span class="line">[handlers]</span><br><span class="line">keys=hWholeConsole,hPartialConsole,hWholeFile,hPartialFile</span><br><span class="line"> </span><br><span class="line">[handler_hWholeConsole]</span><br><span class="line">class=StreamHandler</span><br><span class="line">level=DEBUG</span><br><span class="line">formatter=simpFormatter</span><br><span class="line">args=(sys.stdout,)</span><br><span class="line"> </span><br><span class="line">[handler_hPartialConsole]</span><br><span class="line">class=StreamHandler</span><br><span class="line">level=INFO</span><br><span class="line">formatter=simpFormatter</span><br><span class="line">args=(sys.stderr,)</span><br><span class="line"> </span><br><span class="line">[handler_hWholeFile]</span><br><span class="line">class=FileHandler</span><br><span class="line">level=DEBUG</span><br><span class="line">formatter=timeFormatter</span><br><span class="line">args=(&#x27;out.txt&#x27;, &#x27;a&#x27;)</span><br><span class="line"> </span><br><span class="line">[handler_hPartialFile]</span><br><span class="line">class=FileHandler</span><br><span class="line">level=WARNING</span><br><span class="line">formatter=timeFormatter</span><br><span class="line">args=(&#x27;out.txt&#x27;, &#x27;w&#x27;)</span><br><span class="line"> </span><br><span class="line">###############Formatter###############</span><br><span class="line">[formatters]</span><br><span class="line">keys=simpFormatter,timeFormatter</span><br><span class="line"> </span><br><span class="line">[formatter_simpFormatter]</span><br><span class="line">format=[%(levelname)s] at %(filename)s,%(lineno)d: %(message)s</span><br><span class="line"> </span><br><span class="line">[formatter_timeFormatter]</span><br><span class="line">format=%(asctime)s [%(levelname)s] at %(filename)s,%(lineno)d: %(message)s</span><br><span class="line">datefmt=%Y-%m-%d(%a)%H:%M:%S</span><br><span class="line">此处共创建三个Logger：root，将所有日志输出至控制台；Logger2F，将所有日志写入文件；</span><br><span class="line">Logger2CF，将级别大于或等于INFO的日志输出至控制台，将级别大于或等于WARNING的日志写入文</span><br><span class="line">件。</span><br><span class="line">程序以如下方式解析配置文件和重定向输出：</span><br><span class="line">import logging, logging.config</span><br><span class="line">logging.config.fileConfig(&quot;logger.conf&quot;)</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(&quot;Logger2CF&quot;)</span><br><span class="line">logger.debug(&#x27;gubed&#x27;); logger.info(&#x27;ofni&#x27;); logger.warn(&#x27;nraw&#x27;)</span><br><span class="line">logger.error(&#x27;rorre&#x27;); logger.critical(&#x27;lacitirc&#x27;)</span><br><span class="line"> </span><br><span class="line">logger1 = logging.getLogger(&quot;Logger2F&quot;)</span><br><span class="line">logger1.debug(&#x27;GUBED&#x27;); logger1.critical(&#x27;LACITIRC&#x27;)</span><br><span class="line"> </span><br><span class="line">logger2 = logging.getLogger()</span><br><span class="line">logger2.debug(&#x27;gUbEd&#x27;); logger2.critical(&#x27;lAcItIrC&#x27;)</span><br><span class="line">运行后屏幕上显示:</span><br><span class="line">[INFO] at test.py,7: ofni</span><br><span class="line">[WARNING] at test.py,7: nraw</span><br><span class="line">[ERROR] at test.py,8: rorre</span><br><span class="line">[CRITICAL] at test.py,8: lacitirc</span><br><span class="line">[DEBUG] at test.py,14: gUbEd</span><br><span class="line">[CRITICAL] at test.py,14: lAcItIrC</span><br><span class="line"></span><br><span class="line">out.txt文件内容则为:</span><br><span class="line">2016-05-13(Fri)20:31:21 [WARNING] at test.py,7: nraw</span><br><span class="line">2016-05-13(Fri)20:31:21 [ERROR] at test.py,8: rorre</span><br><span class="line">2016-05-13(Fri)20:31:21 [CRITICAL] at test.py,8: lacitirc</span><br><span class="line">2016-05-13(Fri)20:31:21 [DEBUG] at test.py,11: GUBED</span><br><span class="line">2016-05-13(Fri)20:31:21 [CRITICAL] at test.py,11: LACITIRC</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">以上就是关于Python标准输出的重定向方式的全部内容</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">import sys</span><br><span class="line">saveout = sys.stdout #保存原来的stdout</span><br><span class="line"></span><br><span class="line">f = open(&#x27;out.log&#x27;, &#x27;w&#x27;) </span><br><span class="line">sys.stdout = f  #以后的stdout会重定向到f(out.log)里</span><br><span class="line">print &#x27;This message will be logged instead of displayed&#x27;</span><br><span class="line"></span><br><span class="line">sys.stdout = saveout #把原来的stdout还原回去</span><br><span class="line">f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"># python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/06/python/23%E3%80%81time%E4%B8%8Edatetime/" rel="prev" title="23、time与datetime.md">
      <i class="fa fa-chevron-left"></i> 23、time与datetime.md
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/06/python/24%E3%80%81sys%E4%B8%8Eos/" rel="next" title="24、sys与os.md">
      24、sys与os.md <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#os%E6%A8%A1%E5%9D%97%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE"><span class="nav-number">1.</span> <span class="nav-text">os模块操作系统数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#path%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">path方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0"><span class="nav-number">1.2.</span> <span class="nav-text">跨平台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#statsvfs"><span class="nav-number">1.3.</span> <span class="nav-text">statsvfs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E7%A3%81%E7%9B%98%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="nav-number">1.3.1.</span> <span class="nav-text">监控磁盘使用率</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#python%E8%84%9A%E6%9C%AC%E7%9B%91%E6%8E%A7Linux%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="nav-number">1.3.2.</span> <span class="nav-text">python脚本监控Linux磁盘空间使用率</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python%E8%8E%B7%E5%8F%96CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E3%80%81%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87%E3%80%81%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%80%81"><span class="nav-number">1.3.3.</span> <span class="nav-text">Python获取CPU使用率、内存使用率、网络使用状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%A4%B9%E5%A4%A7%E5%B0%8F"><span class="nav-number">1.3.4.</span> <span class="nav-text">获取文件夹大小</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sys%E6%A8%A1%E5%9D%97"><span class="nav-number">2.</span> <span class="nav-text">sys模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%AE%A1%E9%81%93%E8%BE%93%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.</span> <span class="nav-text">获取管道输入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">2.2.</span> <span class="nav-text">文件重定向</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">tigerfive</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tigerfive</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
